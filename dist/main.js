!function(i){var t={};function e(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return i[s].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=i,e.c=t,e.d=function(i,t,s){e.o(i,t)||Object.defineProperty(i,t,{enumerable:!0,get:s})},e.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,t){if(1&t&&(i=e(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.__esModule)return i;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var r in i)e.d(s,r,function(t){return i[t]}.bind(null,r));return s},e.n=function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,"a",t),t},e.o=function(i,t){return Object.prototype.hasOwnProperty.call(i,t)},e.p="",e(e.s=7)}([function(i){i.exports=JSON.parse('{"frames":{"hud-0-hp":{"frame":{"x":0,"y":0,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-1-hp":{"frame":{"x":0,"y":11,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-2-hp":{"frame":{"x":0,"y":22,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-3-hp":{"frame":{"x":0,"y":33,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"bee-1":{"frame":{"x":0,"y":44,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-2":{"frame":{"x":37,"y":44,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-3":{"frame":{"x":56,"y":0,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-4":{"frame":{"x":0,"y":83,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-5":{"frame":{"x":37,"y":83,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-6":{"frame":{"x":93,"y":0,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-7":{"frame":{"x":74,"y":39,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-8":{"frame":{"x":74,"y":78,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"player-climb-1":{"frame":{"x":0,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-climb-2":{"frame":{"x":37,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-climb-3":{"frame":{"x":74,"y":117,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-1":{"frame":{"x":130,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-2":{"frame":{"x":130,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-3":{"frame":{"x":111,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-4":{"frame":{"x":111,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-1":{"frame":{"x":0,"y":154,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-2":{"frame":{"x":37,"y":154,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-3":{"frame":{"x":74,"y":149,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-4":{"frame":{"x":111,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-hurt-1":{"frame":{"x":167,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-hurt-2":{"frame":{"x":167,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-1":{"frame":{"x":148,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-2":{"frame":{"x":148,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-3":{"frame":{"x":148,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-4":{"frame":{"x":0,"y":186,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-5":{"frame":{"x":37,"y":186,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-6":{"frame":{"x":74,"y":181,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-7":{"frame":{"x":111,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-8":{"frame":{"x":148,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-9":{"frame":{"x":204,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-1":{"frame":{"x":204,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-2":{"frame":{"x":185,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-3":{"frame":{"x":185,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-4":{"frame":{"x":185,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-1":{"frame":{"x":185,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-2":{"frame":{"x":0,"y":218,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-3":{"frame":{"x":37,"y":218,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-4":{"frame":{"x":74,"y":213,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-5":{"frame":{"x":111,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-6":{"frame":{"x":148,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-7":{"frame":{"x":185,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-8":{"frame":{"x":241,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"chest-1":{"frame":{"x":111,"y":224,"w":36,"h":25},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":36,"h":25},"sourceSize":{"w":36,"h":25},"pivot":{"x":0.5,"y":0.5}},"chest-2":{"frame":{"x":241,"y":32,"w":36,"h":25},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":36,"h":25},"sourceSize":{"w":36,"h":25},"pivot":{"x":0.5,"y":0.5}},"slug-skip-1":{"frame":{"x":147,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-2":{"frame":{"x":241,"y":57,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-3":{"frame":{"x":179,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-4":{"frame":{"x":211,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"enemy-death-1":{"frame":{"x":243,"y":78,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-2":{"frame":{"x":243,"y":107,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-3":{"frame":{"x":243,"y":136,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-4":{"frame":{"x":243,"y":165,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-5":{"frame":{"x":222,"y":194,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-6":{"frame":{"x":0,"y":250,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"carrot-1":{"frame":{"x":111,"y":39,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-2":{"frame":{"x":222,"y":64,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-3":{"frame":{"x":222,"y":83,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-4":{"frame":{"x":222,"y":102,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"star-1":{"frame":{"x":222,"y":121,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-2":{"frame":{"x":222,"y":134,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-3":{"frame":{"x":222,"y":147,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-4":{"frame":{"x":222,"y":160,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-5":{"frame":{"x":222,"y":173,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-6":{"frame":{"x":253,"y":194,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"player-climb-4":{"frame":{"x":37,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://free-tex-packer.com","version":"0.6.6","image":"sprites.png","format":"RGBA8888","size":{"w":278,"h":279},"scale":1}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":25,"height":15,"group":"characters","type":"enemy"},"main":{"jumpImpulse":221,"maxSpeed":0.75,"maxJumpingSpeed":9,"isJumping":false,"isJumpTriggered":false,"isFalling":true,"accelerationModifier":6,"brakingModifier":6,"velocityX":0,"velocityY":0,"climbingSpeed":0,"isMovingLeft":false,"isMovingRight":false,"friction":0.09,"isSprinting":false,"isDucking":false,"isKeepDucking":false,"isStuck":false,"isFacingLeft":false,"movingPattern":{"type":"roaming","length":230,"startingPoint":{"x":0,"y":0}}},"animations":{"skip":{"delay":4,"frames":["slug-skip-1","slug-skip-2","slug-skip-3","slug-skip-4"]},"death":{"delay":2,"frames":["enemy-death-1","enemy-death-2","enemy-death-3","enemy-death-4","enemy-death-5","enemy-death-6"]}}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":17,"height":19,"group":"collectables","type":"carrot"},"animations":{"idle":{"delay":6,"frames":["carrot-1","carrot-2","carrot-3","carrot-4"]}}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":13,"height":13,"group":"collectables","type":"star"},"animations":{"idle":{"delay":6,"frames":["star-1","star-2","star-3","star-4","star-5","star-6"]}}}')},function(i){i.exports=JSON.parse('{"0":{"x":0,"y":16,"w":3,"h":7,"m":4},"1":{"x":16,"y":16,"w":3,"h":7,"m":4},"2":{"x":32,"y":16,"w":3,"h":7,"m":4},"3":{"x":48,"y":16,"w":3,"h":7,"m":4},"4":{"x":64,"y":16,"w":3,"h":7,"m":4},"5":{"x":80,"y":16,"w":3,"h":7,"m":4},"6":{"x":96,"y":16,"w":3,"h":7,"m":4},"7":{"x":112,"y":16,"w":3,"h":7,"m":4},"8":{"x":128,"y":16,"w":3,"h":7,"m":4},"9":{"x":144,"y":16,"w":3,"h":7,"m":4}," ":{"x":0,"y":0,"w":2,"h":8,"m":4},"%":{"x":80,"y":0,"w":3,"h":7,"m":4},"!":{"x":15,"y":0,"w":2,"h":8,"m":4},":":{"x":160,"y":16,"w":1,"h":7,"m":4},",":{"x":192,"y":0,"w":2,"h":8,"m":4},"-":{"x":208,"y":0,"w":3,"h":7,"m":4},".":{"x":224,"y":0,"w":2,"h":7,"m":4},"/":{"x":240,"y":0,"w":3,"h":7,"m":4},"A":{"x":16,"y":32,"w":3,"h":7,"m":4},"B":{"x":32,"y":32,"w":3,"h":7,"m":4},"C":{"x":48,"y":32,"w":3,"h":7,"m":4},"D":{"x":64,"y":32,"w":3,"h":7,"m":4},"E":{"x":80,"y":32,"w":3,"h":7,"m":4},"F":{"x":96,"y":32,"w":3,"h":7,"m":4},"G":{"x":112,"y":32,"w":3,"h":7,"m":4},"H":{"x":128,"y":32,"w":3,"h":7,"m":4},"I":{"x":144,"y":32,"w":3,"h":7,"m":4},"J":{"x":160,"y":32,"w":3,"h":7,"m":4},"K":{"x":176,"y":32,"w":3,"h":7,"m":4},"L":{"x":192,"y":32,"w":3,"h":7,"m":4},"M":{"x":208,"y":32,"w":5,"h":7,"m":4},"N":{"x":224,"y":32,"w":3,"h":7,"m":4},"O":{"x":240,"y":32,"w":3,"h":7,"m":4},"P":{"x":0,"y":48,"w":3,"h":7,"m":4},"Q":{"x":16,"y":48,"w":3,"h":7,"m":4},"R":{"x":32,"y":48,"w":3,"h":7,"m":4},"S":{"x":48,"y":48,"w":3,"h":7,"m":4},"T":{"x":64,"y":48,"w":3,"h":7,"m":4},"U":{"x":80,"y":48,"w":3,"h":7,"m":4},"V":{"x":96,"y":48,"w":3,"h":7,"m":4},"W":{"x":112,"y":48,"w":5,"h":7,"m":4},"X":{"x":128,"y":48,"w":3,"h":7,"m":4},"Y":{"x":144,"y":48,"w":3,"h":7,"m":4},"Z":{"x":160,"y":48,"w":3,"h":7,"m":4},"a":{"x":16,"y":64,"w":3,"h":7,"m":4},"b":{"x":32,"y":64,"w":3,"h":7,"m":4},"c":{"x":48,"y":64,"w":3,"h":7,"m":4},"d":{"x":64,"y":64,"w":3,"h":7,"m":4},"e":{"x":80,"y":64,"w":3,"h":7,"m":4},"f":{"x":96,"y":64,"w":3,"h":7,"m":4},"g":{"x":112,"y":64,"w":3,"h":9,"m":4},"h":{"x":128,"y":64,"w":3,"h":7,"m":4},"i":{"x":144,"y":64,"w":1,"h":7,"m":4},"j":{"x":160,"y":64,"w":2,"h":9,"m":4},"k":{"x":176,"y":64,"w":3,"h":7,"m":4},"l":{"x":192,"y":64,"w":2,"h":7,"m":4},"m":{"x":208,"y":64,"w":5,"h":7,"m":4},"n":{"x":224,"y":64,"w":3,"h":7,"m":4},"o":{"x":240,"y":64,"w":3,"h":7,"m":4},"p":{"x":0,"y":80,"w":3,"h":9,"m":4},"q":{"x":16,"y":80,"w":3,"h":9,"m":4},"r":{"x":32,"y":80,"w":3,"h":7,"m":4},"s":{"x":48,"y":80,"w":3,"h":7,"m":4},"t":{"x":64,"y":80,"w":3,"h":7,"m":4},"u":{"x":80,"y":80,"w":3,"h":7,"m":4},"v":{"x":96,"y":80,"w":3,"h":7,"m":4},"w":{"x":112,"y":80,"w":5,"h":7,"m":4},"x":{"x":128,"y":80,"w":3,"h":7,"m":4},"y":{"x":144,"y":80,"w":3,"h":9,"m":4},"z":{"x":160,"y":80,"w":3,"h":7,"m":4}}')},function(i){i.exports=JSON.parse('{"player":{"maxHealth":3},"entity":{"id":"","x":0,"y":0,"width":13,"height":20,"group":"characters","type":"player"},"main":{"jumpImpulse":100,"maxSpeed":3,"maxJumpingSpeed":9,"isJumping":false,"isJumpTriggered":false,"isFalling":true,"accelerationModifier":6,"brakingModifier":6,"velocityX":0,"velocityY":0,"climbingSpeed":2,"isMovingLeft":false,"isMovingRight":false,"friction":0.09,"isSprinting":false,"isDucking":false,"isKeepDucking":false,"isStuck":false,"isFacingLeft":false},"animations":{"idle":{"delay":4,"frames":["player-idle-1","player-idle-2","player-idle-3","player-idle-4","player-idle-5","player-idle-6","player-idle-7","player-idle-8","player-idle-9"]},"skip":{"delay":2,"frames":["player-skip-1","player-skip-2","player-skip-3","player-skip-4","player-skip-5","player-skip-6","player-skip-7","player-skip-8"]},"jump":{"delay":4,"frames":["player-jump-1","player-jump-2","player-jump-3","player-jump-4"]},"fall":{"delay":4,"frames":["player-fall-1","player-fall-2","player-fall-3","player-fall-4"]},"duck":{"delay":4,"frames":["player-duck-1","player-duck-2","player-duck-3","player-duck-4"]},"hurt":{"delay":2,"frames":["player-hurt-1","player-hurt-2"]},"death":{"delay":2,"frames":["player-hurt-1","player-hurt-2"]},"climb":{"delay":2,"frames":["player-climb-1","player-climb-2","player-climb-3","player-climb-4"]}}}')},function(i){i.exports=JSON.parse('{"frames":{"house":{"frame":{"x":0,"y":0,"w":181,"h":157},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":181,"h":157},"sourceSize":{"w":181,"h":157},"pivot":{"x":0.5,"y":0.5}},"tree-2":{"frame":{"x":0,"y":157,"w":62,"h":108},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":62,"h":108},"sourceSize":{"w":62,"h":108},"pivot":{"x":0.5,"y":0.5}},"tree-1":{"frame":{"x":62,"y":157,"w":57,"h":77},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":57,"h":77},"sourceSize":{"w":57,"h":77},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://free-tex-packer.com","version":"0.6.5","image":"images.png","format":"RGBA8888","size":{"w":181,"h":265},"scale":1}}')},function(i,t,e){"use strict";function s(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}e.r(t);var r=class{constructor(){s(this,"isActive",void 0),s(this,"isHold",void 0),this.isActive=!1,this.isHold=!1}getInput(i){switch(i){case"keydown":this.isActive&&(this.isHold=!0),this.isActive=!0;break;case"keyup":this.isActive=!1,this.isHold=!1}}};function a(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function o(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class h{constructor(i,t,e){this.bus=i,o(this,"x",0),o(this,"y",0),o(this,"xOld",0),o(this,"yOld",0),o(this,"width",void 0),o(this,"height",void 0),o(this,"transitionTo",void 0),o(this,"transitionFrom",void 0),o(this,"transitionSteps",void 0),o(this,"transitionCounter",void 0),this.width=t,this.height=e,this.subscribeToEvents()}transitionCamera(i){var{to:t,steps:e=10,from:s}=i;this.transitionCounter=e,this.transitionTo=t,this.transitionSteps=e,this.transitionFrom=s||{x:this.x,y:this.y}}subscribeToEvents(){this.bus.subscribe(this.bus.TRANSITION_CAMERA,this.transitionCamera.bind(this))}adjustCamera(i,t,e){var s;this.xOld=this.x,this.yOld=this.y,this.transitionCounter?(s||(s=this.transitionFrom),s.x+=(this.transitionTo.x-this.transitionFrom.x)/this.transitionSteps,s.y+=(this.transitionTo.y-this.transitionFrom.y)/this.transitionSteps,console.log(s.x,this.transitionTo.x),this.transitionCounter-=1):s=i;var r=s.x-this.width/2,a=s.y-this.height/2;r<0&&(r=0),s.x+this.width/2>t&&(r=t-this.width),a<0&&(a=0),s.y+this.height/2>e&&(a=e-this.height),this.x=Math.round(r),this.y=Math.round(a)}}function n(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var l=class{constructor(i,t,e,s,r,a,o){switch(n(this,"vertexShader",void 0),n(this,"fragmentShader",void 0),n(this,"program",void 0),n(this,"aPosition",void 0),n(this,"aTextureCoord",void 0),n(this,"uResolution",void 0),n(this,"uColor",void 0),n(this,"uTranslation",void 0),n(this,"uScale",void 0),n(this,"uTexture",void 0),n(this,"positionBuffer",void 0),n(this,"textureCoordBuffer",void 0),n(this,"uTextureMatrix",void 0),n(this,"uTilesAmount",void 0),n(this,"uTextureCoord",void 0),n(this,"tileCoords",void 0),this.vertexShader=this.compileShader(i,i.VERTEX_SHADER,t),this.fragmentShader=this.compileShader(i,i.FRAGMENT_SHADER,e),this.program=this.compileProgram(i),s){case"rectangle":this.aPosition=i.getAttribLocation(this.program,"aPosition"),this.uResolution=i.getUniformLocation(this.program,"uResolution"),this.uColor=i.getUniformLocation(this.program,"uColor");break;case"image":this.aPosition=i.getAttribLocation(this.program,"aPosition"),this.aTextureCoord=i.getAttribLocation(this.program,"aTextureCoord"),this.uResolution=i.getUniformLocation(this.program,"uResolution"),this.uTranslation=i.getUniformLocation(this.program,"uTranslation"),this.uScale=i.getUniformLocation(this.program,"uScale"),this.uTextureMatrix=i.getUniformLocation(this.program,"uTextureMatrix"),this.positionBuffer=i.createBuffer(),this.textureCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW);break;case"layer":this.aPosition=i.getAttribLocation(this.program,"aPosition"),this.uResolution=i.getUniformLocation(this.program,"uResolution"),this.uTranslation=i.getUniformLocation(this.program,"uTranslation"),this.uScale=i.getUniformLocation(this.program,"uScale"),this.uTextureMatrix=i.getUniformLocation(this.program,"uTextureMatrix"),this.uTilesAmount=i.getUniformLocation(this.program,"uTilesAmount"),this.uTextureCoord=i.getUniformLocation(this.program,"uTextureCoord"),this.textureCoordBuffer=i.createBuffer();var h=r/o,l=a/o;this.tileCoords=[];for(var c=0;c<l;c+=1)for(var u=0;u<h;u+=1)this.tileCoords.push([u*o/r,c*o/a,(u*o+o)/r,c*o/a,u*o/r,(c*o+o)/a,u*o/r,(c*o+o)/a,(u*o+o)/r,c*o/a,(u*o+o)/r,(c*o+o)/a])}}compileShader(i,t,e){var s=i.createShader(t);if(i.shaderSource(s,e),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(s));return s}compileProgram(i){var t=i.createProgram();if(i.attachShader(t,this.vertexShader),i.attachShader(t,this.fragmentShader),i.linkProgram(t),!i.getProgramParameter(t,i.LINK_STATUS))throw i.deleteProgram(t),t=null,new Error(i.getProgramInfoLog(t));return t}};class c{translation(i,t){var e=new Float32Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=i,e[7]=t,e[8]=1,e}scale(i,t,e){var s=new Float32Array(9);return s[0]=t*i[0],s[1]=t*i[1],s[2]=t*i[2],s[3]=e*i[3],s[4]=e*i[4],s[5]=e*i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s}}var u="\n    attribute vec4 aPosition;\n\n    uniform vec2 uResolution;\n\n    void main() {\n      // convert the position from pixels to clipspace\n      vec2 clipSpace = ((aPosition.xy / uResolution) * 2.0) - 1.0;\n\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n    }\n  ",d="\n    precision mediump float;\n\n    uniform vec4 uColor;\n\n    void main() {\n      gl_FragColor = uColor;\n    }\n  ",m="\n    attribute vec2 aPosition;\n\n    uniform vec2 uResolution;\n    uniform vec2 uTranslation;\n    uniform vec2 uScale;\n\n    uniform mat3 uTextureMatrix;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n      // Scale the position\n      vec2 scaledPosition = aPosition * uScale;\n\n      // Add in the translation.\n      vec2 position = scaledPosition + uTranslation;\n\n      // convert the position from pixels to clipspace\n      vec2 clipSpace = ((position / uResolution) * 2.0) - 1.0;\n\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n      vTextureCoord = (uTextureMatrix * vec3(aPosition, 1)).xy;\n    }\n  ",p="\n    precision mediump float;\n\n    uniform sampler2D uTexture;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTextureCoord);\n    }\n  ",g="\n    #define maxTiles 144\n\n    attribute vec2 aTextureCoord;\n\n    uniform vec2 uResolution;\n    uniform vec2 uTranslation;\n    uniform vec2 uScale;\n    uniform mat3 uTextureMatrix[maxTiles];\n    uniform int uTilesAmount;\n\n    varying vec2 vTextureCoord;\n\n    int index = 0;\n\n    void main() {\n      vec2 scaledPosition = aTextureCoord * uScale;\n      vec2 position = scaledPosition;\n      vec2 clipSpace = ((position / uResolution) * 2.0) - 1.0;\n\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n      // vTextureCoord = (uTextureMatrix[gl_VertexID] * vec3(aTextureCoord, 1)).xy;\n      vTextureCoord = (vec3(aTextureCoord, 1)).xy;\n\n      ++index;\n    }\n  ",f="\n    precision mediump float;\n\n    uniform sampler2D uTexture;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTextureCoord);\n    }\n  ";function y(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function v(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class b{constructor(i){this.bus=i,v(this,"width",236),v(this,"height",66),v(this,"xPadding",15),v(this,"yPadding",13),v(this,"offsetMax",70),v(this,"offsetStep",5),v(this,"background",void 0),v(this,"offset",70),v(this,"text",""),v(this,"fontSize",1),v(this,"align","center"),v(this,"resolve",void 0),v(this,"isResolved",!1),v(this,"isWaiting",!1),v(this,"isVisible",!1),v(this,"id",void 0),v(this,"fontSizeDefault",1),v(this,"alignDefault","center"),this.subscribeToEvents()}startWaiting(){this.bus.publish(this.bus.ENABLE_CONTROLS)}subscribeToEvents(){this.bus.subscribe(this.bus.SHOW_POPUP,this.callPopup.bind(this))}callPopup(i){return new Promise(t=>{this.isResolved=!1,this.isWaiting=!1,this.bus.publish(this.bus.DISABLE_CONTROLS),this.bus.publish(this.bus.FREEZE_CHARACTERS),this.isVisible=!0,"object"==typeof i?(this.text=i.text,this.fontSize=i.fontSize?i.fontSize:this.fontSizeDefault,this.align=i.align?i.align:this.alignDefault):(this.text=i,this.fontSize=this.fontSizeDefault),this.id=this.bus.subscribe(this.bus.HIDE_POPUP,()=>this.startHiding(t))})}startHiding(i){this.bus.publish(this.bus.DISABLE_CONTROLS),this.bus.unsubscribe(this.bus.HIDE_POPUP,this.id),this.isVisible=!1,this.resolve=()=>{this.bus.publish(this.bus.UNFREEZE_CHARACTERS),this.bus.publish(this.bus.ENABLE_CONTROLS),i()}}}function w(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class x{constructor(i){this.bus=i,w(this,"titleVisibilityStep",.2),w(this,"titleVisibilityMax",1),w(this,"titleVisibility",0),w(this,"isVisible",!1),w(this,"text",void 0),this.subscribeToEvents()}subscribeToEvents(){this.bus.subscribe(this.bus.SHOW_ZONE_TITLE,this.show.bind(this))}show(i){this.text=i,this.isVisible=!0,setTimeout(()=>{this.isVisible=!1},3e3)}}var S=e(4);function T(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class P{constructor(i,t,e,s){this.bus=i,this.library=t,T(this,"context2D",void 0),T(this,"camera",void 0),T(this,"renderer",void 0),T(this,"contextWebGL",void 0),T(this,"imagesMap",void 0),T(this,"popup",void 0),T(this,"backgrounds",void 0),T(this,"mapTileset",void 0),T(this,"images",void 0),T(this,"zoneTitle",void 0),this.context2D=this.library.context2D,this.contextWebGL=this.library.contextWebGL,this.backgrounds=[],this.camera=new h(i,e,s),this.renderer=new class{constructor(i,t,e,s){y(this,"gl",void 0),y(this,"rectangleProgram",void 0),y(this,"imageProgram",void 0),y(this,"layerProgram",void 0),y(this,"matrix",void 0),y(this,"aPosition",void 0),y(this,"uResolution",void 0),y(this,"uColor",void 0),this.gl=i,this.matrix=new c,this.rectangleProgram=new l(this.gl,u,d,"rectangle"),this.imageProgram=new l(this.gl,m,p,"image"),this.layerProgram=new l(this.gl,g,f,"layer",t,e,s)}drawRect(i,t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.gl.DYNAMIC_DRAW),this.gl.useProgram(this.rectangleProgram.program),this.gl.enableVertexAttribArray(this.rectangleProgram.aPosition),this.gl.vertexAttribPointer(this.rectangleProgram.aPosition,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.rectangleProgram.uResolution,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform4f(this.rectangleProgram.uColor,t[0]/255,t[1]/255,t[2]/255,t[3]),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}drawImage(i,t,e,s,r,a,o,h,n,l,c){void 0===h&&(h=s),void 0===n&&(n=r),void 0===a&&(a=t),void 0===o&&(o=e),void 0===l&&(l=a),void 0===c&&(c=o),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.useProgram(this.imageProgram.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.imageProgram.positionBuffer),this.gl.enableVertexAttribArray(this.imageProgram.aPosition),this.gl.vertexAttribPointer(this.imageProgram.aPosition,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.imageProgram.uResolution,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform2f(this.imageProgram.uTranslation,h,n),this.gl.uniform2f(this.imageProgram.uScale,l,c);var u=this.matrix.translation(s/t,r/e);u=this.matrix.scale(u,a/t,o/e),this.gl.uniformMatrix3fv(this.imageProgram.uTextureMatrix,!1,u),this.gl.uniform1i(this.imageProgram.uTexture,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}drawLayer(i,t,e,s,r){this.gl.useProgram(this.layerProgram.program);for(var a=[],o=0,h=0;h<r.length;h+=1){var n=void 0;a=a.concat(this.layerProgram.tileCoords[h]),n=this.matrix.translation(r[h].sourceX/t,r[h].sourceY/e),n=this.matrix.scale(n,r[h].tileSize/t,r[h].tileSize/e),this.gl.uniformMatrix3fv(this.layerProgram.uTextureMatrix,!1,n),o+=1}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.layerProgram.textureCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(a),this.gl.STATIC_DRAW),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.layerProgram.textureCoordBuffer),this.gl.enableVertexAttribArray(this.layerProgram.aTextureCoord),this.gl.vertexAttribPointer(this.layerProgram.aTextureCoord,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.layerProgram.uResolution,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform2f(this.layerProgram.uTranslation,s.x,s.y),this.gl.uniform2f(this.layerProgram.uScale,s.width,s.height),this.gl.uniform1i(this.layerProgram.uTexture,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6*o)}clear(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}(this.contextWebGL,e,s,16),this.popup=new b(this.bus),this.zoneTitle=new x(this.bus)}drawLayer(i,t,e){for(var s=[],r=0;r<i.length;r+=1)if(i[r]){var a=i[r],o=r,h=a%this.mapTileset.columns,n=h?Math.floor(a/this.mapTileset.columns):a/this.mapTileset.columns-1,l=h?h-1:this.mapTileset.columns-1,c=Math.floor(o/t),u=o%t,d=this.mapTileset.tileSize*l,m=this.mapTileset.tileSize*n,p=this.mapTileset.tileSize*u,g=this.mapTileset.tileSize*c;e&&a>=e.firstgid?this.drawLargeTiles(e,a,p,g):this.isObjectWithinCamera(p,g)&&s.push({sourceX:d,sourceY:m,mapX:p,mapY:g,tileSize:this.mapTileset.tileSize})}this.renderer.drawLayer(this.mapTileset.texture,this.mapTileset.image.width,this.mapTileset.image.height,this.camera,s)}adjustBufferCanvasSize(i,t){this.contextWebGL.canvas.width=i,this.contextWebGL.canvas.height=t}drawZoneTitle(){this.zoneTitle.isVisible&&this.drawText("- ".concat(this.zoneTitle.text," -"),this.camera.width/2,this.camera.height/5,"center",2)}drawLoading(){var i=Math.ceil(this.library.loadingProgress),t=this.camera.width/100*this.library.loadingProgress,e=this.camera.width/2-t/2;this.renderer.drawRect([e,this.camera.height/2-10,e+t,this.camera.height/2-10,e,this.camera.height/2+10,e,this.camera.height/2+10,e+t,this.camera.height/2-10,e+t,this.camera.height/2+10],[65,43,15,1]),this.library.images.font.texture&&(this.drawText("".concat(Math.ceil(i),"%"),this.camera.width/2,this.camera.height/2-7,"center",2),100===this.library.loadingProgress&&this.drawText("Press any key",this.camera.width/2,this.camera.height/2+28,"center",3))}drawPopup(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:68,e=11+5.5*(this.popup.fontSize-1);if(!this.popup.isVisible&&this.popup.offset>this.popup.offsetMax)this.popup.resolve&&!this.popup.isResolved&&(this.popup.resolve(),this.popup.isResolved=!0);else if(this.popup.isVisible&&this.popup.offset>0?this.popup.offset-=this.popup.offsetStep:this.popup.isVisible?this.popup.startWaiting&&!this.popup.isWaiting&&(this.popup.startWaiting(),this.popup.isWaiting=!0):this.popup.offset+=this.popup.offsetStep,this.drawObject(!1,this.library.images.popup,0,0,this.camera.x+i,this.camera.y+t+this.popup.offset,this.popup.width,this.popup.height),this.popup.text){var s=0,r=0;switch(this.popup.align){case"left":s=i+this.popup.xPadding,r=t+this.popup.yPadding+this.popup.offset;break;case"right":s=i+this.popup.width-this.popup.xPadding,r=t+this.popup.yPadding+this.popup.offset;break;case"center":s=i+this.popup.width/2,r=t+this.popup.offset+this.popup.height/2}if(Array.isArray(this.popup.text))for(var a=0;a<this.popup.text.length;a+=1)this.drawText(this.popup.text[a],s,"center"===this.popup.align?r-(e*this.popup.text.length/2-e*a):r+e*a,this.popup.align,this.popup.fontSize);else this.drawText(this.popup.text,s,"center"===this.popup.align?r-e/2:r,this.popup.align,this.popup.fontSize)}}drawText(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=S,o=i.split(""),h=0,n=0;switch(s){case"right":o=o.reverse();break;case"center":for(var l=1;l<=o.length;l+=1){var c=a[o[l-1]];n+=l===o.length?c.w*r:(c.w+1)*r}}for(var u=0;u<o.length;u+=1){var d=a[o[u]],m=!!o[u-1]?a[o[u-1]].w:0;u&&(h+=m+1);var p=void 0;switch(s){case"left":p=this.camera.x+t+h*r;break;case"right":p=this.camera.x+t-h*r;break;case"center":p=this.camera.x+t+h*r-n/2}this.drawObject(!1,this.library.images.font,d.x,d.y+d.m,p,this.camera.y+e,d.w,d.h,d.w*r,d.h*r)}}drawCharacters(i){i.forEach(i=>{var t;i.isVanished||(t=i.isFacingLeft?i.animator.flippedSpriteMap.frames[i.animator.frameValue].frame:i.animator.spriteMap.frames[i.animator.frameValue].frame,this.drawObject(i.isFacingLeft,this.library.images.spriteSheet,t.x,t.y,i.left+Math.floor(.5*i.width-.5*t.w),i.top-Math.floor(t.h-i.height),t.w,t.h))})}drawCollectables(i){i.forEach(i=>{if(!i.isVanished){var t=i.animator.spriteMap.frames[i.animator.frameValue].frame;this.drawObject(!1,this.library.images.spriteSheet,t.x,t.y,i.left,i.top,t.w,t.h)}})}drawHud(i,t){var e=t.frames["hud-".concat(i.currentHealth,"-hp")];if(e){var{frame:s}=e;this.drawObject(!1,this.library.images.spriteSheet,s.x,s.y,this.camera.x+2,this.camera.y+2,s.w,s.h),this.drawText("".concat(i.currentStars),52,4,"right")}}drawObject(i,t,e,s,r,a,o,h,n,l){void 0===n&&(n=o),void 0===l&&(l=h),this.isObjectWithinCamera(r,a)&&this.renderer.drawImage(i?t.flippedTexture:t.texture,t.image.width,t.image.height,e,s,o,h,Math.round(r),Math.round(a),n,l)}drawBackgrounds(){for(var i=0;i<this.backgrounds.length;i+=1){var t=0,e=0,s=i+1;for(t+=this.camera.x/(6*s),e+=this.camera.y/(10.66*s),this.renderer.drawImage(this.backgrounds[i].texture,this.backgrounds[i].image.width,this.backgrounds[i].image.height,0,0,this.backgrounds[i].image.width,this.backgrounds[i].image.height,t,e,this.backgrounds[i].image.width,this.backgrounds[i].image.height);t+this.backgrounds[i].image.width<=this.camera.x+this.camera.width;)t+=this.backgrounds[i].image.width,this.renderer.drawImage(this.backgrounds[i].texture,this.backgrounds[i].image.width,this.backgrounds[i].image.height,0,0,this.backgrounds[i].image.width,this.backgrounds[i].image.height,t,e,this.backgrounds[i].image.width,this.backgrounds[i].image.height)}}drawCollisionDebugMap(i){for(var t={top:[255,0,0,.5],"top-left":[255,100,0,.5],"top-right":[255,0,136,.5],left:[0,181,204,.5],right:[145,61,136,.5],bottom:[255,255,0,.5],"bottom-left":[255,255,204,.5],"bottom-right":[255,255,136,.5],full:[200,200,200,.5]},e=0;e<i.length;e+=1)for(var s=0;s<i[e].length;s+=1)"collisions"===i[e][s].group&&this.renderer.drawRect([i[e][s].x,i[e][s].y,i[e][s].x+i[e][s].width,i[e][s].y,i[e][s].x,i[e][s].y+i[e][s].height,i[e][s].x,i[e][s].y+i[e][s].height,i[e][s].x+i[e][s].width,i[e][s].y,i[e][s].x+i[e][s].width,i[e][s].y+i[e][s].height],t[i[e][s].type])}drawMap(i,t,e){for(var s=0;s<i.length;s+=1)if(i[s]){var r=i[s],a=s,o=r%this.mapTileset.columns,h=o?Math.floor(r/this.mapTileset.columns):r/this.mapTileset.columns-1,n=o?o-1:this.mapTileset.columns-1,l=Math.floor(a/t),c=a%t,u=this.mapTileset.tileSize*n,d=this.mapTileset.tileSize*h,m=this.mapTileset.tileSize*c,p=this.mapTileset.tileSize*l;e&&r>=e.firstgid&&this.drawLargeTiles(e,r,m,p),this.isObjectWithinCamera(m,p)&&this.renderer.drawImage(this.mapTileset.texture,this.mapTileset.image.width,this.mapTileset.image.height,u,d,this.mapTileset.tileSize,this.mapTileset.tileSize,m,p,this.mapTileset.tileSize,this.mapTileset.tileSize)}}render(){this.context2D.drawImage(this.contextWebGL.canvas,this.camera.x,this.camera.y,this.camera.width,this.camera.height,0,0,this.context2D.canvas.width,this.context2D.canvas.height)}resize(i,t,e){t/i>e?(this.context2D.canvas.height=i*e,this.context2D.canvas.width=i):(this.context2D.canvas.height=t,this.context2D.canvas.width=t/e),this.context2D.imageSmoothingEnabled=!1}isObjectWithinCamera(i,t,e,s){void 0===e&&(e=i),void 0===s&&(s=t);var r=this.mapTileset?2*this.mapTileset.tileSize:32;return!(t>this.camera.y+this.camera.height+r||s<this.camera.y-r||i>this.camera.x+this.camera.width+r||e<this.camera.x-r)}drawLargeTiles(i,t,e,s){var r=i.tiles[t-i.firstgid],a=this.imagesMap.frames[r.type],o=e,h=s-(a.frame.h-this.mapTileset.tileSize);this.isObjectWithinCamera(o,h,o+a.frame.w,h+a.frame.h)&&this.renderer.drawImage(this.images.texture,this.images.image.width,this.images.image.height,a.frame.x,a.frame.y,a.frame.w,a.frame.h,o,h,a.frame.w,a.frame.h)}}function z(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class A{constructor(i){z(this,"group",void 0),z(this,"type",void 0),z(this,"collisionType",null),z(this,"collisionXDirection",""),z(this,"collisionYDirection",""),z(this,"id",void 0),z(this,"properties",void 0),z(this,"defaults",void 0),z(this,"width",void 0),z(this,"height",void 0),z(this,"isVanished",!1),z(this,"x",void 0),z(this,"y",void 0),z(this,"xOld",void 0),z(this,"yOld",void 0),Object.assign(this,i),this.defaults=i,this.xOld=i.x,this.yOld=i.y}get top(){return this.y}set top(i){this.y=i}get right(){return this.x+this.width}set right(i){this.x=i-this.width}get bottom(){return this.y+this.height}set bottom(i){this.y=i-this.height}get left(){return this.x}set left(i){this.x=i}get oldTop(){return this.yOld}set oldTop(i){this.yOld=i}get oldRight(){return this.xOld+this.width}set oldRight(i){this.xOld=i-this.width}get oldBottom(){return this.yOld+this.height}set oldBottom(i){this.yOld=i-this.height}get oldLeft(){return this.xOld}set oldLeft(i){this.xOld=i}}function C(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class M{constructor(i,t){this.spriteMap=i,this.animations=t,C(this,"frameValue",""),C(this,"flippedSpriteMap",void 0),C(this,"count",0),C(this,"delay",0),C(this,"mode","pause"),C(this,"activeFrameSet",""),C(this,"frameIndex",0),this.spriteMap=i,this.flippedSpriteMap=i,this.animations=t,this.getXFlippedCoords()}animate(){switch(this.mode){case"loop":this.loop()}}changeFrameset(i,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"loop",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i;this.animations[r]||(r=Object.keys(this.animations)[0]);var a=t||this.animations[r].delay;this.activeFrameSet===r&&a===this.delay||(this.count=0,this.delay=a,this.mode=e,this.activeFrameSet=r,this.frameIndex=s,this.frameValue=this.animations[r].frames[this.frameIndex])}getXFlippedCoords(){this.flippedSpriteMap=JSON.parse(JSON.stringify(this.spriteMap)),Object.keys(this.flippedSpriteMap.frames).map(i=>{this.flippedSpriteMap.frames[i].frame.x=this.flippedSpriteMap.meta.size.w-this.flippedSpriteMap.frames[i].frame.x-this.flippedSpriteMap.frames[i].frame.w})}loop(){this.count+=1,this.count>this.delay&&(this.count-=this.delay,this.frameIndex=this.frameIndex<this.animations[this.activeFrameSet].frames.length-1?this.frameIndex+1:0,this.frameValue=this.animations[this.activeFrameSet].frames[this.frameIndex])}}class k extends A{constructor(i,t){var e,s,r,{entity:a,animations:o}=i;super(a),r=void 0,(s="animator")in(e=this)?Object.defineProperty(e,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[s]=r,this.setAnimationDefaults(o,t)}update(){this.updateAnimation()}setAnimationDefaults(i,t){this.animator=new M(t,i)}updateAnimation(){this.animator.changeFrameset("idle"),this.animator.animate()}}function L(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function R(i){return function(){var t=this,e=arguments;return new Promise((function(s,r){var a=i.apply(t,e);function o(i){L(a,s,r,o,h,"next",i)}function h(i){L(a,s,r,o,h,"throw",i)}o(void 0)}))}}function E(i){return O.apply(this,arguments)}function O(){return(O=R((function*(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"json",e=yield fetch(i);switch(t){case"json":return e.json();case"arrayBuffer":return e.arrayBuffer()}}))).apply(this,arguments)}function F(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class D extends A{constructor(i,t,e,s){var{entity:r,main:a,animations:o}=e;super(r),this.bus=i,this.library=t,F(this,"isMovingLeft",void 0),F(this,"isMovingRight",void 0),F(this,"isJumpTriggered",void 0),F(this,"isJumping",void 0),F(this,"isFalling",void 0),F(this,"isSprinting",void 0),F(this,"isDucking",void 0),F(this,"isClimbing",void 0),F(this,"climbingDirection",void 0),F(this,"isHurt",void 0),F(this,"isDeathTriggered",!1),F(this,"isKeepDucking",void 0),F(this,"isFacingLeft",void 0),F(this,"isStuck",void 0),F(this,"velocityX",void 0),F(this,"velocityY",void 0),F(this,"animator",void 0),F(this,"movingPattern",void 0),F(this,"isJumpActive",void 0),F(this,"isUpActive",void 0),F(this,"isKeepJumping",void 0),F(this,"maxJumpingSpeed",void 0),F(this,"climbingSpeed",void 0),F(this,"maxSpeed",void 0),F(this,"accelerationModifier",void 0),F(this,"brakingModifier",void 0),F(this,"jumpImpulse",void 0),F(this,"velocityYModifier",void 0),F(this,"friction",void 0),F(this,"duckingTimer",void 0),F(this,"jumpingTimer",void 0),F(this,"isFreezed",!1),Object.assign(this,a),this.setAnimationDefaults(o,s),this.subscribeToEvents()}startMovingLeft(){this.isMovingRight||this.isDucking||this.isHurt||(this.isFacingLeft=!0,this.isMovingLeft=!0)}stopMovingLeft(){this.isMovingLeft=!1}startMovingRight(){this.isMovingLeft||this.isDucking||this.isHurt||(this.isFacingLeft=!1,this.isMovingRight=!0)}stopMovingRight(){this.isMovingRight=!1}startJumping(){this.isStuck||(this.isClimbing=!1,this.isJumping||(this.jumpingTimer=setTimeout(()=>{this.isKeepJumping=!0},100)),this.isJumpTriggered=!0)}stopJumping(){clearTimeout(this.jumpingTimer),this.isJumpTriggered=!1,this.isKeepJumping=!1}startDucking(){this.isJumping||this.isFalling||this.isHurt||(this.isDucking||(this.top+=5,this.duckingTimer=setTimeout(()=>{this.isKeepDucking=!0},1e3)),this.isDucking=!0,this.isSprinting=!1,this.isMovingLeft=!1,this.isMovingRight=!1,this.brakingModifier=24,this.height=15)}stopDucking(){this.isDucking=!1,this.isKeepDucking=!1,clearTimeout(this.duckingTimer),this.brakingModifier=6,this.height=20,this.top-=5}startSprinting(){this.isJumping||this.isDucking||this.isHurt||(this.isSprinting=!0,this.maxSpeed=5,this.accelerationModifier=10)}stopSprinting(){this.isSprinting=!1,this.maxSpeed=3,this.accelerationModifier=6}startClimbingAndMoving(i){this.climbingDirection=i}stopClimbingAndMoving(){this.climbingDirection=null}getHurt(){this.isDeathTriggered=!0,this.library.sounds.hit.play(),setTimeout(()=>{this.isVanished=!0},350)}update(i){this.adjustHorizontalMovement(),this.adjustVerticalMovement(i),this.updateAnimation(),this.collisionType&&("ropes"!==this.collisionType||this.isClimbing)||(this.velocityY>0&&!this.isOnSurface&&(this.isFalling=!0),this.isClimbing=!1)}freeze(){this.isFreezed=!0}unfreeze(){this.isFreezed=!1}subscribeToEvents(){this.bus.subscribe(this.bus.FREEZE_CHARACTERS,this.freeze.bind(this)),this.bus.subscribe(this.bus.UNFREEZE_CHARACTERS,this.unfreeze.bind(this))}get isOnSurface(){return this.top-this.oldTop<1}get isMoving(){return(this.isMovingLeft||this.isMovingRight)&&!this.isJumping&&!this.isFalling&&!this.isClimbing}get isBeganToDie(){return this.isDeathTriggered&&!this.isVanished}setAnimationDefaults(i,t){this.animator=new M(t,i)}updateAnimation(){this.isHurt?this.animator.changeFrameset("hurt"):this.isBeganToDie?this.animator.changeFrameset("death"):this.isMoving?this.isSprinting?this.animator.changeFrameset("skip",1.33):this.animator.changeFrameset("skip"):this.isFalling?this.animator.changeFrameset("fall"):this.isClimbing?this.climbingDirection?this.animator.changeFrameset("climb"):this.animator.changeFrameset("climb",30,"pause"):this.isJumping?this.animator.changeFrameset("jump"):this.isDucking?this.animator.changeFrameset("duck"):this.animator.changeFrameset("idle"),this.animator.animate()}adjustVerticalMovement(i){var t,e,s;if(!this.isFreezed&&("enemy"!==this.type||!this.isDeathTriggered))if(this.oldTop=this.top,this.isClimbing){switch(this.climbingDirection){case"up":this.velocityY=-this.climbingSpeed;break;case"down":this.velocityY=this.climbingSpeed;break;default:this.velocityY=0}this.top+=this.velocityY}else{var r=i;this.isKeepJumping&&this.velocityY<0?r*=.6:this.isKeepJumping=!1,this.velocityYModifier=r,!this.isJumpTriggered||this.isJumping||this.isFalling||(this.velocityYModifier-=this.jumpImpulse,this.isJumping=!0),this.velocityY=(t=this.velocityY+this.friction*this.velocityYModifier,e=-this.maxJumpingSpeed,s=this.maxJumpingSpeed,Math.max(e,Math.min(s,t))),this.top+=this.velocityY+this.friction*this.velocityY}}adjustHorizontalMovement(){if(!this.isFreezed&&!this.isDeathTriggered)if(this.oldLeft=this.left,this.isClimbing){switch(this.climbingDirection){case"left":this.velocityX=-this.climbingSpeed;break;case"right":this.velocityX=this.climbingSpeed;break;default:this.velocityX=0}this.left+=this.velocityX}else this.isMovingLeft?(this.velocityX>-this.maxSpeed&&(this.velocityX-=this.maxSpeed/this.accelerationModifier),this.velocityX<-this.maxSpeed&&(this.velocityX+=this.maxSpeed/this.accelerationModifier)):this.isMovingRight?(this.velocityX<this.maxSpeed&&(this.velocityX+=this.maxSpeed/this.accelerationModifier),this.velocityX>this.maxSpeed&&(this.velocityX-=this.maxSpeed/this.accelerationModifier)):this.isMovingLeft||this.isMovingRight||(this.velocityX<0&&(this.velocityX+=this.maxSpeed/this.brakingModifier,this.velocityX>0&&(this.velocityX=0)),this.velocityX>0&&(this.velocityX-=this.maxSpeed/this.brakingModifier,this.velocityX<0&&(this.velocityX=0))),this.left+=this.velocityX}}class j{constructor(){var i,t,e;e=void 0,(t="characters")in(i=this)?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,this.characters=[]}bindCharacter(i){this.characters.push({character:i,startingPoint:i.movingPattern.startingPoint,reachedLeftBorder:!1,reachedRightBorder:!1})}update(){this.checkBroadPhase()}checkBroadPhase(){for(var i=0;i<this.characters.length;i+=1)if(this.characters[i].character.movingPattern)switch(this.characters[i].character.movingPattern.type){case"roaming":this.processRoaming(i)}}processRoaming(i){var{character:t,startingPoint:e,reachedLeftBorder:s,reachedRightBorder:r}=this.characters[i],a=t.left>e.x-t.movingPattern.length,o=t.left<t.movingPattern.length+e.x,h="left"!==t.collisionXDirection,n="right"!==t.collisionXDirection,l=t.left<e.x-t.movingPattern.length,c=t.left>t.movingPattern.length+e.x;!s&&!r||!s&&r?a&&h?(t.stopMovingRight(),t.startMovingLeft(),t.collisionXDirection=""):c?(t.stopMovingLeft(),t.startMovingRight()):(this.characters[i].reachedLeftBorder=!0,this.characters[i].reachedRightBorder=!1):s&&!r&&(o&&n?(t.stopMovingLeft(),t.startMovingRight(),t.collisionXDirection=""):l?(t.stopMovingRight(),t.startMovingLeft()):(this.characters[i].reachedRightBorder=!0,this.characters[i].reachedLeftBorder=!1))}}var B=e(0),_=e(1),I=e(2),V=e(3);function H(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),e.push.apply(e,s)}return e}function N(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function U(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function X(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function J(i){return function(){var t=this,e=arguments;return new Promise((function(s,r){var a=i.apply(t,e);function o(i){X(a,s,r,o,h,"next",i)}function h(i){X(a,s,r,o,h,"throw",i)}o(void 0)}))}}function W(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class Y extends D{constructor(i,t,e,s,r){super(i,t,e,s),this.maximumStars=r,W(this,"destination",{name:"",x:0,y:0}),W(this,"currentHealth",void 0),W(this,"maxHealth",void 0),W(this,"currentStars",0),W(this,"cameraPosition",{x:this.left,y:this.top}),W(this,"cameraVelocity",0),W(this,"cameraVelocityModifier",4),W(this,"cameraMaxVelocity",100),this.maxHealth=e.player.maxHealth,this.currentHealth=this.maxHealth}startJumping(){super.startJumping(),this.isJumping||this.isFalling||this.library.sounds.jump.play()}obtainStar(){this.currentStars+=1,this.currentStars===this.maximumStars&&this.bus.publish(this.bus.SHOW_POPUP,"Wow! You have collected all the stars!")}restoreHealth(){this.currentHealth<this.maxHealth&&(this.currentHealth+=1)}throwUp(i){switch(i){case"fromThePit":this.velocityY-=7;break;case"attacker":this.velocityY-=50,this.isUpActive&&(this.isKeepJumping=!0);break;case"left":this.top-=1,this.velocityY-=50,this.velocityX-=5;break;case"right":this.top-=1,this.velocityY-=50,this.velocityX+=5;break;case"death":this.top-=1,this.velocityY-=50,this.maxJumpingSpeed=11}}getHurt(i){var t=this;this.isHurt||(this.library.sounds.hurt.play(),this.bus.publish(this.bus.DISABLE_CONTROLS),this.stopMovingLeft(),this.stopMovingRight(),this.isHurt=!0,this.currentHealth-=1,this.currentHealth<=0?(this.isDeathTriggered=!0,this.throwUp("death"),setTimeout(J((function*(){yield t.bus.publish(t.bus.SHOW_POPUP,{text:"YOU DIED",fontSize:3}),t.isVanished=!0,t.bus.publish(t.bus.APP_RESTART),t.bus.publish(t.bus.ENABLE_CONTROLS)})),1200)):(this.throwUp("death"),setTimeout(()=>{this.isHurt=!1,this.bus.publish(this.bus.ENABLE_CONTROLS),i&&this.bus.publish(this.bus.TELEPORT_PLAYER,i)},600)))}getCameraPositionRelativeToPlayer(i,t){if(!this.isDeathTriggered){var e,s=t;return this.isDucking?(s=t-(this.defaults.height-this.height),this.isKeepDucking&&this.cameraVelocity<=this.cameraMaxVelocity&&(this.cameraVelocity+=this.cameraVelocityModifier)):this.cameraVelocity&&(this.cameraVelocity-=this.cameraVelocityModifier),e=s+this.cameraVelocity,{x:i+this.defaults.width/2,y:e+this.defaults.height/2}}}update(i){this.updateCameraPosition(),super.update(i)}updateCameraPosition(){var i=this.getCameraPositionRelativeToPlayer(this.left,this.top);i&&(this.cameraPosition.x=i.x,this.cameraPosition.y=i.y)}}var Z=e(5);function G(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}var K=class{constructor(i,t,e){this.bus=i,this.library=t,G(this,"objects",{}),G(this,"player",void 0),G(this,"spriteMap",void 0),G(this,"world",void 0),G(this,"maximumStars",17),G(this,"zones",void 0),this.spriteMap=B,this.zones=this.library.zones,this.player=this.createPlayer(),this.loadZone(e)}createPlayer(){return new Y(this.bus,this.library,Z,this.spriteMap,this.maximumStars)}loadZone(i){this.objects[i]=this.objects[i]||{},this.world=new class{constructor(i,t,e,s,r){this.bus=i,this.library=t,this.player=e,this.map=s,this.collection=r,U(this,"height",void 0),U(this,"width",void 0),U(this,"backgroundMap",void 0),U(this,"middleBackgroundMap",void 0),U(this,"middleFrontMap",void 0),U(this,"middleMap",void 0),U(this,"frontMap",void 0),U(this,"collisionDebugMap",void 0),U(this,"columns",void 0),U(this,"rows",void 0),U(this,"activeZone",void 0),U(this,"gravity",void 0),U(this,"tileSize",void 0),U(this,"collider",void 0),U(this,"rawLayers",void 0),U(this,"doors",void 0),U(this,"collisions",void 0),U(this,"brain",void 0),U(this,"ropes",void 0),U(this,"spikes",void 0),U(this,"return-points",void 0),this.gravity=10,this.columns=s.width,this.rows=s.height,this.tileSize=s.tilewidth,this.width=this.columns*this.tileSize,this.height=this.rows*this.tileSize,this.player=e,this.brain=new j,this.processMap(this.map),this.collider=new class{constructor(i,t){this.bus=i,this.library=t}processBroadPhase(i){return this.bruteForce(i)}routeCharacterVsCollision(i,t){switch(i.isStuck=!1,t.type){case"top":this.isCollidingFromTop(i,t)&&this.collideCharacterVsCollisionFromTop(i,t);break;case"right":this.isCollidingFromRight(i,t)&&this.collideCharacterVsCollisionFromRight(i,t);break;case"bottom":this.isCollidingFromBottom(i,t)&&this.collideCharacterVsCollisionFromBottom(i,t);break;case"left":this.isCollidingFromLeft(i,t)&&this.collideCharacterVsCollisionFromLeft(i,t);break;case"top-left":if(this.isCollidingFromTop(i,t))return void this.collideCharacterVsCollisionFromTop(i,t);this.isCollidingFromLeft(i,t)&&this.collideCharacterVsCollisionFromLeft(i,t);break;case"top-right":if(this.isCollidingFromTop(i,t))return void this.collideCharacterVsCollisionFromTop(i,t);this.isCollidingFromRight(i,t)&&this.collideCharacterVsCollisionFromRight(i,t);break;case"bottom-right":if(this.isCollidingFromRight(i,t))return void this.collideCharacterVsCollisionFromRight(i,t);this.isCollidingFromBottom(i,t)&&this.collideCharacterVsCollisionFromBottom(i,t);break;case"bottom-left":if(this.isCollidingFromLeft(i,t))return void this.collideCharacterVsCollisionFromLeft(i,t);this.isCollidingFromBottom(i,t)&&this.collideCharacterVsCollisionFromBottom(i,t);break;case"full":if(this.isCollidingFromTop(i,t))return void this.collideCharacterVsCollisionFromTop(i,t);if(this.isCollidingFromLeft(i,t))return void this.collideCharacterVsCollisionFromLeft(i,t);if(this.isCollidingFromRight(i,t))return void this.collideCharacterVsCollisionFromRight(i,t);this.isCollidingFromBottom(i,t)&&this.collideCharacterVsCollisionFromBottom(i,t),i.isStuck=!0}}routePlayerVsDoor(i,t){var{target:e}=t.properties,s=parseInt(t.properties.offset),r=t.properties.destinationX?parseInt(t.properties.destinationX):null,a=t.properties.destinationY?parseInt(t.properties.destinationY):null,o={};"vertical"===t.type?(this.isCollidingFromLeft(i,t)?o.x=r:o.x=r-i.width,o.y=i.top+s):(this.isCollidingFromTop(i,t)?o.y=a:(o.y=a-i.height,i.throwUp("fromThePit")),o.x=i.left+s),o.name=e,this.bus.publish(this.bus.LOAD_ZONE,o)}routePlayerVsEnemy(i,t){if(!t.isVanished)return this.isCollidingFromTop(i,t)||this.isCollidingFromBottom(t,i)?(t.getHurt(),void i.throwUp("attacker")):void(this.isCollidingFromRight(i,t)||this.isCollidingFromBottom(i,t)||this.isCollidingFromTop(t,i)||this.isCollidingFromLeft(t,i)?(i.collisionXDirection="right",i.getHurt()):(this.isCollidingFromLeft(i,t)||this.isCollidingFromRight(t,i))&&(i.collisionXDirection="left",i.getHurt()))}routePlayerVsCollectable(i,t){if(!t.isVanished)switch(t.type){case"carrot":t.isVanished=!0,i.restoreHealth(),this.library.sounds.carrot.play({isSimultaneous:!0});break;case"star":t.isVanished=!0,i.obtainStar(),this.library.sounds.star.play({isSimultaneous:!0})}}routePlayerVsRope(i){i.isUpActive&&(i.isClimbing=!0,i.isJumping=!1,i.isFalling=!1)}routeCharacterVsSpikes(i){i.getHurt()}routePlayerVsSpikes(i,t){i.getHurt(t.properties.target)}isCollidingFromTop(i,t){return i.bottom>t.top&&i.oldBottom<=t.top}isCollidingFromRight(i,t){return i.left<t.right&&i.oldLeft>=t.right}isCollidingFromBottom(i,t){return i.top<t.bottom&&i.oldTop>=t.bottom}isCollidingFromLeft(i,t){return i.right>t.left&&i.oldRight<=t.left}bruteForce(i){var t=i.length,e=[];if(t>1)for(var s=0;s<t;s+=1)for(var r=i[s],a=s+1;a<t;a+=1){var o=i[a];this.broadPhaseComparator(r,o)?(this.broadPhaseResolver(r,o),e.push([r,o]),r.collisionType=o.group,o.collisionType=r.group):(r.collisionType=null,o.collisionType=null)}return e}broadPhaseComparator(i,t){return("characters"===i.group||"characters"===t.group)&&(i.left<t.right&&t.left<i.right&&i.top<t.bottom&&t.top<i.bottom)}broadPhaseResolver(i,t){i.isDeathTriggered||t.isDeathTriggered||("characters"===i.group&&"collisions"===t.group?this.routeCharacterVsCollision(i,t):"characters"===i.group&&"characters"===t.group?"player"===i.type&&"enemy"===t.type&&this.routePlayerVsEnemy(i,t):"characters"===i.group&&"doors"===t.group?"player"===i.type&&this.routePlayerVsDoor(i,t):"characters"===i.group&&"collectables"===t.group?"player"===i.type&&this.routePlayerVsCollectable(i,t):"characters"===i.group&&"ropes"===t.group?"player"===i.type&&this.routePlayerVsRope(i):"characters"===i.group&&"spikes"===t.group&&("player"===i.type?this.routePlayerVsSpikes(i,t):this.routeCharacterVsSpikes(i)))}collideCharacterVsCollisionFromTop(i,t){"player"===i.type&&i.isFalling&&this.library.sounds.land.play(),i.bottom=t.top-.01,i.velocityY=0,i.isJumping=!1,i.isFalling=!1,i.collisionYDirection="bottom",t.collisionYDirection="top"}collideCharacterVsCollisionFromRight(i,t){i.left=t.right,i.velocityX=0,i.collisionXDirection="left",t.collisionXDirection="right"}collideCharacterVsCollisionFromBottom(i,t){i.top=t.bottom,i.velocityY=0,i.isJumping=!1,i.isFalling=!0,i.collisionYDirection="top",t.collisionYDirection="bottom"}collideCharacterVsCollisionFromLeft(i,t){i.right=t.left-.01,i.velocityX=0,i.collisionXDirection="right",t.collisionXDirection="left"}}(i,this.library),this.subscribeToEvents()}update(){this.collection.characters.forEach(i=>{i.isVanished||(i.update(this.gravity),this.processBoundariesCollision(i))}),this.collection.collectables.forEach(i=>{i.isVanished||i.update()});var i=this.collider.processBroadPhase([...this.collection.characters,...this.collisions,...this.doors,...this.collection.collectables,...this.ropes,...this.spikes]);this.collisionDebugMap=i,this.brain.update()}teleport(i){var t,e=this;return(t=function*(){!function(i){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?H(Object(e),!0).forEach((function(t){U(i,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):H(Object(e)).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))}))}}({},e.player.cameraPosition);var[t]=e["return-points"].filter(t=>t.id===i);t&&(e.player.bottom=t.bottom,e.player.left=t.left)},function(){var i=this,e=arguments;return new Promise((function(s,r){var a=t.apply(i,e);function o(i){N(a,s,r,o,h,"next",i)}function h(i){N(a,s,r,o,h,"throw",i)}o(void 0)}))})()}fillMapLayer(i){return i.objects.map(t=>new A({id:t.id,x:t.x,y:t.y,width:t.width,height:t.height,group:i.name,type:t.type,properties:t.properties?t.properties.reduce((i,t)=>(i[t.name]=t.value,i),{}):{}}))}processMap(i){this.collection.collectables=this.collection.collectables||[],this.collection.characters=this.collection.characters||[],this.rawLayers=i.layers.reduce((i,t)=>{var e,s;switch(t.name){case"tiles":t.layers.forEach(t=>i[t.name]=t.data);break;case"objects":t.layers.forEach(t=>{switch(t.name){case"collisions":case"doors":case"ropes":case"spikes":case"return-points":i[t.name]=this.fillMapLayer(t);break;case"collectables":i[t.name]=t.objects.map((i,t)=>{switch(i.type){case"carrot":return e="carrot_".concat(t),(s=this.collection.collectables.filter(i=>i.id===e)[0])||(I.entity.id=e,I.entity.x=i.x,I.entity.y=i.y,new k(I,B));case"star":return e="star_".concat(t),(s=this.collection.collectables.filter(i=>i.id===e)[0])||(V.entity.id=e,V.entity.x=i.x,V.entity.y=i.y,new k(V,B))}});break;case"characters":i[t.name]=t.objects.map((i,t)=>{switch(i.type){case"player":return this.player.destination.name.length?(this.player.left=this.player.destination.x,this.player.top=this.player.destination.y):(this.player.left=i.x,this.player.top=i.y),this.player;case"enemy":switch(i.name){case"slug":if(e="slug_".concat(t),!(s=this.collection.characters.filter(i=>i.id===e)[0])){_.entity.id=e,_.entity.x=i.x,_.entity.y=i.y,_.main.movingPattern.startingPoint={x:i.x,y:i.y};var r=new D(this.bus,this.library,_,B);return this.brain.bindCharacter(r),r}return s.movingPattern.startingPoint={x:i.x,y:i.y},this.brain.bindCharacter(s),s}}})}})}return i},{}),this.backgroundMap=[...this.rawLayers.background],this.rawLayers["middle-background"]&&(this.middleBackgroundMap=[...this.rawLayers["middle-background"]]),this.middleMap=[...this.rawLayers.middle],this.rawLayers["middle-front"]&&(this.middleFrontMap=[...this.rawLayers["middle-front"]]),this.frontMap=[...this.rawLayers.front],this.collisions=[...this.rawLayers.collisions],this.collection.characters=[...this.rawLayers.characters],this.doors=[...this.rawLayers.doors],this.ropes=this.rawLayers.ropes?[...this.rawLayers.ropes]:[],this.collection.collectables=this.rawLayers.collectables?[...this.rawLayers.collectables]:[],this.spikes=this.rawLayers.spikes?[...this.rawLayers.spikes]:[],this["return-points"]=this.rawLayers["return-points"]?[...this.rawLayers["return-points"]]:[],this.collisionDebugMap=[]}processBoundariesCollision(i){i.isDeathTriggered||(i.left<0&&(i.left=0,i.velocityX=0),i.left+i.width>this.width&&(i.left=this.width-i.width,i.velocityX=0),i.top<0&&(i.top=0,i.velocityY=0),i.top+i.height>this.height&&(i.isJumping=!1,i.top=this.height-i.height,i.velocityY=0))}subscribeToEvents(){this.bus.subscribe(this.bus.TELEPORT_PLAYER,this.teleport.bind(this))}}(this.bus,this.library,this.player,this.zones[i].config,this.objects[i]),this.world.activeZone=i}update(){this.world.update()}};function q(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function Q(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}function $(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function ii(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class ti{constructor(){ii(this,"FREEZE_CHARACTERS","character.freeze"),ii(this,"UNFREEZE_CHARACTERS","character.unfreeze"),ii(this,"SHOW_POPUP","popup.callPopup"),ii(this,"HIDE_POPUP","popup.startHiding"),ii(this,"DISABLE_CONTROLS","app.disableControls"),ii(this,"ENABLE_CONTROLS","app.enableControls"),ii(this,"LOAD_ZONE","app.loadZone"),ii(this,"APP_RESTART","app.restart"),ii(this,"APP_PAUSE","app.pause"),ii(this,"APP_RESUME","app.resume"),ii(this,"SHOW_ZONE_TITLE","zoneTitle.show"),ii(this,"TELEPORT_PLAYER","world.teleport"),ii(this,"TRANSITION_CAMERA","camera.makeTransition"),ii(this,"subscriptions",{}),ii(this,"lastId",0)}subscribe(i,t){var e=this.getId();return this.subscriptions[i]||(this.subscriptions[i]={}),this.subscriptions[i][e]=t,e}unsubscribe(i,t){delete this.subscriptions[i][t]}publish(i,t){var e,s=this;return(e=function*(){if(s.subscriptions[i]){var e=Object.keys(s.subscriptions[i]);for(var r of e)yield s.subscriptions[i][r](t)}},function(){var i=this,t=arguments;return new Promise((function(s,r){var a=e.apply(i,t);function o(i){$(a,s,r,o,h,"next",i)}function h(i){$(a,s,r,o,h,"throw",i)}o(void 0)}))})()}getId(){return this.lastId+=1,"".concat(this.lastId)}}function ei(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function si(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class ri{constructor(i){si(this,"image",void 0),si(this,"tileSize",void 0),si(this,"columns",void 0),si(this,"flippedImage",void 0),si(this,"texture",void 0),si(this,"flippedTexture",void 0),si(this,"url",void 0),si(this,"gl",void 0),this.gl=i,this.image=new Image}loadAsset(i){var t,e=arguments,s=this;return(t=function*(){var t=e.length>1&&void 0!==e[1]&&e[1];s.url=i,t?(yield Promise.all([s.loadImage(i),s.flipImage(i)]),s.texture=s.createTexture(s.image),s.flippedTexture=s.createTexture(s.flippedImage)):(yield s.loadImage(i),s.texture=s.createTexture(s.image))},function(){var i=this,e=arguments;return new Promise((function(s,r){var a=t.apply(i,e);function o(i){ei(a,s,r,o,h,"next",i)}function h(i){ei(a,s,r,o,h,"throw",i)}o(void 0)}))})()}createTexture(i){var t=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),t}loadImage(i){return new Promise((t,e)=>{this.image.addEventListener("load",()=>t()),this.image.addEventListener("error",i=>e(i)),this.image.src=i})}flipImage(i){return new Promise((t,e)=>{var s=document.createElement("canvas").getContext("2d"),r=new Image;r.src=i,r.addEventListener("error",i=>e(i)),r.addEventListener("load",()=>{s.canvas.width=r.width,s.canvas.height=r.height,s.save(),s.scale(-1,1),s.drawImage(r,-r.width,0,r.width,r.height),s.restore(),this.flippedImage=s.canvas,t()},{once:!0})})}}function ai(i,t){var e=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),e.push.apply(e,s)}return e}function oi(i){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?ai(Object(e),!0).forEach((function(t){ni(i,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(e)):ai(Object(e)).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(e,t))}))}return i}function hi(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function ni(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class li{constructor(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.defaultVolume=t,ni(this,"context",void 0),ni(this,"buffer",void 0),ni(this,"isAlreadyPlaying",void 0),ni(this,"gainNode",void 0),ni(this,"source",void 0),ni(this,"params",void 0),ni(this,"pausedTime",0),this.context=i,this.gainNode=this.context.createGain()}loadAsset(i){var t,e=this;return(t=function*(){return E(i,"arrayBuffer").then(i=>e.decodeAudioData(i))},function(){var i=this,e=arguments;return new Promise((function(s,r){var a=t.apply(i,e);function o(i){hi(a,s,r,o,h,"next",i)}function h(i){hi(a,s,r,o,h,"throw",i)}o(void 0)}))})()}play(){var{isSimultaneous:i=!1,volume:t=this.defaultVolume,loop:e=!1,startTime:s=0,fadeInTime:r=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isAlreadyPlaying&&!i||(this.params={isSimultaneous:i,volume:t,loop:e,startTime:s},this.isAlreadyPlaying=!0,this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.addEventListener("ended",()=>{this.isAlreadyPlaying=!1}),this.source.connect(this.gainNode),this.gainNode.connect(this.context.destination),r?(this.gainNode.gain.value=0,this.gainNode.gain.linearRampToValueAtTime(t,this.context.currentTime+r/1e3)):this.gainNode.gain.value=t,this.source.start(0,s/1e3),this.params.startTime=s,this.source.loop=e)}resume(i){this.params=oi(oi({},this.params),i),this.pausedTime=this.pausedTime?this.pausedTime:Date.now(),this.params.startTime=Date.now()-this.pausedTime,this.play(this.params)}pause(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i?(this.isAlreadyPlaying=!1,this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+i/1e3),setTimeout(()=>{this.source.stop()},i)):this.source.stop(),this.pausedTime=Date.now()-this.params.startTime}decodeAudioData(i){this.context.decodeAudioData(i,i=>{this.buffer=i})}}var ci=e.p+"assets/images/clouds-back.png",ui=e.p+"assets/images/clouds-front.png",di=e.p+"assets/images/bg-back.png",mi=e.p+"assets/images/bg-front.png",pi=e.p+"assets/images/default-tileset.png",gi=e.p+"assets/images/sunny-land-tileset.png",fi=e.p+"assets/images/images.png",yi=e(6),vi=e.p+"assets/images/sprites.png",bi=e.p+"assets/images/popup.png",wi=e.p+"assets/images/font.png",xi=e.p+"assets/sounds/jump.ogg",Si=e.p+"assets/sounds/land.ogg",Ti=e.p+"assets/sounds/hit.ogg",Pi=e.p+"assets/sounds/carrot.ogg",zi=e.p+"assets/sounds/star.ogg",Ai=e.p+"assets/sounds/hurt.ogg",Ci=e.p+"assets/sounds/confiant.mp3",Mi=e.p+"assets/sounds/soliditeNaturelle.mp3";function ki(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function Li(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}class Ri{constructor(i){Li(this,"loadingProgress",0),Li(this,"contextWebGL",void 0),Li(this,"context2D",void 0),Li(this,"contextAudio",void 0),Li(this,"images",{}),Li(this,"sounds",{}),Li(this,"gameMaps",{}),Li(this,"defaultImagesMap",void 0),this.context2D=i.getContext("2d"),this.contextWebGL=document.createElement("canvas").getContext("webgl"),this.contextAudio=new AudioContext,this.images={cloudsBack:new ri(this.contextWebGL),cloudsFront:new ri(this.contextWebGL),bgBack:new ri(this.contextWebGL),bgFront:new ri(this.contextWebGL),defaultTileSet:new ri(this.contextWebGL),sunnyLandTileSet:new ri(this.contextWebGL),defaultImages:new ri(this.contextWebGL),spriteSheet:new ri(this.contextWebGL),popup:new ri(this.contextWebGL),font:new ri(this.contextWebGL)},this.sounds={jump:new li(this.contextAudio,.1),land:new li(this.contextAudio,.1),hit:new li(this.contextAudio,.3),carrot:new li(this.contextAudio,.5),star:new li(this.contextAudio,.3),hurt:new li(this.contextAudio,.3),confiant:new li(this.contextAudio,1),soliditeNaturelle:new li(this.contextAudio,1)},this.defaultImagesMap=yi}initAssets(){var i,t=this;return(i=function*(){return function(i,t){var e=0;for(var s of(t(0),i))s.then(()=>{e++,t(100*e/i.length)});return Promise.all(i)}([t.images.font.loadAsset(wi),t.images.cloudsBack.loadAsset(ci),t.images.cloudsFront.loadAsset(ui),t.images.bgBack.loadAsset(di),t.images.bgFront.loadAsset(mi),t.images.defaultTileSet.loadAsset(pi),t.images.sunnyLandTileSet.loadAsset(gi),t.images.defaultImages.loadAsset(fi),t.images.spriteSheet.loadAsset(vi,!0),t.images.popup.loadAsset(bi),E("".concat("./assets","/levels/zoneA0.json")).then(i=>t.gameMaps.zoneA0=i),E("".concat("./assets","/levels/zoneA1.json")).then(i=>t.gameMaps.zoneA1=i),E("".concat("./assets","/levels/zoneA2.json")).then(i=>t.gameMaps.zoneA2=i),E("".concat("./assets","/levels/zoneB0.json")).then(i=>t.gameMaps.zoneB0=i),E("".concat("./assets","/levels/zoneB1.json")).then(i=>t.gameMaps.zoneB1=i),E("".concat("./assets","/levels/zoneB2.json")).then(i=>t.gameMaps.zoneB2=i),E("".concat("./assets","/levels/zoneB3.json")).then(i=>t.gameMaps.zoneB3=i),t.sounds.jump.loadAsset(xi),t.sounds.hit.loadAsset(Ti),t.sounds.carrot.loadAsset(Pi),t.sounds.star.loadAsset(zi),t.sounds.hurt.loadAsset(Ai),t.sounds.land.loadAsset(Si),t.sounds.confiant.loadAsset(Ci),t.sounds.soliditeNaturelle.loadAsset(Mi)],i=>{t.loadingProgress=i})},function(){var t=this,e=arguments;return new Promise((function(s,r){var a=i.apply(t,e);function o(i){ki(a,s,r,o,h,"next",i)}function h(i){ki(a,s,r,o,h,"throw",i)}o(void 0)}))})()}get zones(){return{zoneA0:{title:"GrassHills",group:"zoneA",config:this.gameMaps.zoneA0,tileset:this.images.defaultTileSet,backgrounds:[this.images.cloudsBack,this.images.cloudsFront,this.images.bgBack,this.images.bgFront],images:{spriteSheet:this.images.defaultImages,spriteMap:this.defaultImagesMap},audio:{bgm:this.sounds.confiant}},zoneA1:{title:"GrassHills",group:"zoneA",config:this.gameMaps.zoneA1,tileset:this.images.defaultTileSet,backgrounds:[this.images.cloudsBack,this.images.cloudsFront],images:{spriteSheet:this.images.defaultImages,spriteMap:this.defaultImagesMap},audio:{bgm:this.sounds.confiant}},zoneA2:{title:"GrassHills",group:"zoneA",config:this.gameMaps.zoneA2,tileset:this.images.defaultTileSet,backgrounds:[this.images.cloudsBack,this.images.cloudsFront],images:{spriteSheet:this.images.defaultImages,spriteMap:this.defaultImagesMap},audio:{bgm:this.sounds.confiant}},zoneB0:{title:"Caverns",group:"zoneB",config:this.gameMaps.zoneB0,tileset:this.images.sunnyLandTileSet,backgrounds:[],images:{},audio:{bgm:this.sounds.soliditeNaturelle}},zoneB1:{title:"Caverns",group:"zoneB",config:this.gameMaps.zoneB1,tileset:this.images.sunnyLandTileSet,backgrounds:[],images:{},audio:{bgm:this.sounds.soliditeNaturelle}},zoneB2:{title:"Caverns",group:"zoneB",config:this.gameMaps.zoneB2,tileset:this.images.sunnyLandTileSet,backgrounds:[],images:{},audio:{bgm:this.sounds.soliditeNaturelle}},zoneB3:{title:"Caverns",group:"zoneB",config:this.gameMaps.zoneB3,tileset:this.images.sunnyLandTileSet,backgrounds:[],images:{},audio:{bgm:this.sounds.soliditeNaturelle}}}}}function Ei(i,t,e,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void e(i)}h.done?t(n):Promise.resolve(n).then(s,r)}function Oi(i){return function(){var t=this,e=arguments;return new Promise((function(s,r){var a=i.apply(t,e);function o(i){Ei(a,s,r,o,h,"next",i)}function h(i){Ei(a,s,r,o,h,"throw",i)}o(void 0)}))}}function Fi(i,t,e){return t in i?Object.defineProperty(i,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):i[t]=e,i}window.addEventListener("DOMContentLoaded",()=>{new class{constructor(){Fi(this,"aspectRatio",9/16),Fi(this,"fps",1e3/30),Fi(this,"startingZone","zoneA1"),Fi(this,"controller",void 0),Fi(this,"game",void 0),Fi(this,"display",void 0),Fi(this,"engine",void 0),Fi(this,"bus",void 0),Fi(this,"library",void 0),Fi(this,"areControlsDisabled",!1),Fi(this,"state",void 0),Fi(this,"isMuted",!1),this.init()}restart(){this.updateZoneAudio(this.game.world.activeZone,this.startingZone),this.game=new K(this.bus,this.library,this.startingZone),this.updateZoneAssets()}init(){var i=this;return Oi((function*(){i.bus=new ti,i.library=new Ri(document.getElementById("game")),i.controller=new class{constructor(){a(this,"left",void 0),a(this,"right",void 0),a(this,"up",void 0),a(this,"shift",void 0),a(this,"down",void 0),a(this,"jump",void 0),a(this,"mute",void 0),this.left=new r,this.right=new r,this.up=new r,this.shift=new r,this.down=new r,this.jump=new r,this.mute=new r}get isAnyKeyIsActive(){return this.left.isActive||this.right.isActive||this.up.isActive||this.shift.isActive||this.up.isActive||this.down.isActive||this.jump.isActive||this.mute.isActive}handleKeyEvent(i,t){switch(t){case 37:this.left.getInput(i);break;case 38:this.up.getInput(i);break;case 39:this.right.getInput(i);break;case 16:this.shift.getInput(i);break;case 40:this.down.getInput(i);break;case 90:this.jump.getInput(i);break;case 77:this.mute.getInput(i)}}},i.display=new P(i.bus,i.library,256,144),i.engine=new class{constructor(i,t,e){Q(this,"render",void 0),Q(this,"update",void 0),Q(this,"animationFrame",void 0),Q(this,"handleRun",void 0),Q(this,"timeStep",void 0),Q(this,"accumulatedTime",void 0),Q(this,"previousTime",void 0),Q(this,"isUpdated",void 0),this.update=e,this.render=t,this.animationFrame=()=>{},this.handleRun=()=>{},this.timeStep=i,this.previousTime=0,this.accumulatedTime=0,this.isUpdated=!1}run(i){var t,e=this;return(t=function*(){for(e.animationFrame=window.requestAnimationFrame(e.handleRun),e.accumulatedTime+=i-e.previousTime,e.previousTime=i,e.accumulatedTime>=3*e.timeStep&&(e.accumulatedTime=e.timeStep);e.accumulatedTime>=e.timeStep;)e.accumulatedTime-=e.timeStep,yield e.update(e.timeStep),e.isUpdated=!0;e.isUpdated&&(e.isUpdated=!1,e.render())},function(){var i=this,e=arguments;return new Promise((function(s,r){var a=t.apply(i,e);function o(i){q(a,s,r,o,h,"next",i)}function h(i){q(a,s,r,o,h,"throw",i)}o(void 0)}))})()}start(){this.accumulatedTime=this.timeStep,this.previousTime=window.performance.now(),this.animationFrame=window.requestAnimationFrame(this.handleRun=this.run.bind(this))}stop(){window.cancelAnimationFrame(this.animationFrame)}}(i.fps,i.render.bind(i),i.update.bind(i)),i.subscribeToEvents(),i.state="loading",i.resize(),i.engine.start(),yield i.library.initAssets(),i.game=new K(i.bus,i.library,i.startingZone),i.display.contextWebGL.canvas.height=i.game.world.height,i.display.contextWebGL.canvas.width=i.game.world.width,i.updateZoneAssets()}))()}subscribeToEvents(){window.addEventListener("keydown",this.handleKeyEvent.bind(this)),window.addEventListener("keyup",this.handleKeyEvent.bind(this)),window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("blur",()=>this.bus.publish(this.bus.APP_PAUSE)),window.addEventListener("focus",()=>this.bus.publish(this.bus.APP_RESUME)),this.bus.subscribe(this.bus.DISABLE_CONTROLS,this.disableControls.bind(this)),this.bus.subscribe(this.bus.ENABLE_CONTROLS,this.enableControls.bind(this)),this.bus.subscribe(this.bus.LOAD_ZONE,this.loadZone.bind(this)),this.bus.subscribe(this.bus.APP_RESTART,this.restart.bind(this)),this.bus.subscribe(this.bus.APP_PAUSE,this.pauseGame.bind(this)),this.bus.subscribe(this.bus.APP_RESUME,this.resumeGame.bind(this))}disableControls(){this.areControlsDisabled=!0}enableControls(){this.areControlsDisabled=!1}startGame(){var i=this;this.state="game",this.updateZoneAudio(null,this.game.world.activeZone),setTimeout(Oi((function*(){yield i.bus.publish(i.bus.SHOW_POPUP,{text:["Welcome!","Movement: arrow buttons. Jump: Z. Sprint: Shift.","Mute: M.","Find some stars! Eat lots of carrots!"],align:"center"}),i.bus.publish(i.bus.SHOW_ZONE_TITLE,i.library.zones[i.game.world.activeZone].title)})),300)}pauseGame(){this.engine.stop(),this.library.contextAudio.suspend()}resumeGame(){this.engine.start(),this.isMuted||this.library.contextAudio.resume()}handleKeyEvent(i){"loading"===this.state&&100===this.library.loadingProgress&&this.startGame(),this.controller.handleKeyEvent(i.type,i.keyCode),this.controller.mute.isActive&&!this.controller.mute.isHold&&(this.isMuted?(this.isMuted=!1,this.library.contextAudio.resume()):(this.isMuted=!0,this.library.contextAudio.suspend()))}adjustMovingControls(){this.controller.left.isActive?this.game.player.startMovingLeft():this.game.player.isMovingLeft&&this.game.player.stopMovingLeft(),this.controller.right.isActive?this.game.player.startMovingRight():this.game.player.isMovingRight&&this.game.player.stopMovingRight(),this.controller.jump.isActive&&!this.controller.jump.isHold?this.game.player.startJumping():this.game.player.isJumpTriggered&&this.game.player.stopJumping(),this.controller.shift.isActive?this.game.player.startSprinting():this.game.player.isSprinting&&this.game.player.stopSprinting(),this.controller.down.isActive?this.game.player.startDucking():this.game.player.isDucking&&this.game.player.stopDucking()}adjustClimbingControls(){this.controller.up.isActive||this.controller.right.isActive||this.controller.down.isActive||this.controller.left.isActive||this.game.player.stopClimbingAndMoving(),this.controller.left.isActive&&this.game.player.startClimbingAndMoving("left"),this.controller.right.isActive&&this.game.player.startClimbingAndMoving("right"),this.controller.down.isActive&&this.game.player.startClimbingAndMoving("down"),this.controller.up.isActive&&this.game.player.startClimbingAndMoving("up"),!this.controller.jump.isActive||this.controller.jump.isHold||this.game.player.climbingDirection?this.game.player.isJumpTriggered&&this.game.player.stopJumping():this.game.player.startJumping()}resize(){this.display.resize(document.documentElement.clientWidth,document.documentElement.clientHeight,this.aspectRatio),this.display.render(),this.game&&this.display.camera.adjustCamera(this.game.player.cameraPosition,this.game.world.width,this.game.world.height)}render(){switch(this.display.renderer.clear(),this.state){case"loading":this.display.drawLoading(),this.display.render();break;case"game":this.display.camera.adjustCamera(this.game.player.cameraPosition,this.game.world.width,this.game.world.height);var i=this.library.zones[this.game.world.activeZone].config.tilesets.filter(i=>"images"===i.name)[0];this.display.drawBackgrounds(),this.display.drawMap(this.game.world.backgroundMap,this.game.world.columns,i),this.game.world.middleBackgroundMap&&this.display.drawMap(this.game.world.middleBackgroundMap,this.game.world.columns,i),this.display.drawMap(this.game.world.middleMap,this.game.world.columns,i),this.game.world.middleFrontMap&&this.display.drawMap(this.game.world.middleFrontMap,this.game.world.columns,i),this.display.drawCharacters(this.game.objects[this.game.world.activeZone].characters),this.display.drawCollectables(this.game.objects[this.game.world.activeZone].collectables),this.display.drawMap(this.game.world.frontMap,this.game.world.columns,i),window.SHOW_COLLISIONS&&this.display.drawCollisionDebugMap(this.game.world.collisionDebugMap),this.display.drawHud(this.game.player,this.game.spriteMap),this.display.drawPopup(),this.display.drawZoneTitle(),this.display.render()}}update(){switch(this.state){case"game":this.game.player.isJumpActive=this.controller.jump.isActive,this.game.player.isUpActive=this.controller.up.isActive,this.areControlsDisabled||(this.controller.isAnyKeyIsActive&&this.bus.publish(this.bus.HIDE_POPUP),this.game.player.isClimbing?this.adjustClimbingControls():this.adjustMovingControls()),this.game.update()}}loadZone(i){this.engine.stop(),this.game.player.destination.x=i.x,this.game.player.destination.y=i.y,this.game.player.destination.name=i.name,this.updateZoneAudio(this.game.world.activeZone,i.name),this.library.zones[this.game.world.activeZone].group!==this.library.zones[i.name].group&&this.bus.publish(this.bus.SHOW_ZONE_TITLE,this.library.zones[i.name].title),this.game.loadZone(i.name),this.display.camera.adjustCamera(this.game.player.cameraPosition,this.game.world.width,this.game.world.height),this.updateZoneAssets(),this.engine.start()}updateZoneAudio(i,t){var e=this.library.zones[i],s=this.library.zones[t],r=e?e.audio.ambient:null,a=e?e.audio.bgm:null,o=s?s.audio.ambient:null,h=s?s.audio.bgm:null;r!==o&&(r&&r.pause(2e3),o&&o.resume({loop:!0,fadeInTime:2e3})),a!==h&&(a&&a.pause(2e3),h&&h.resume({loop:!0,fadeInTime:2e3}))}updateZoneAssets(){this.display.backgrounds=this.library.zones[this.game.world.activeZone].backgrounds,this.display.mapTileset=this.library.zones[this.game.world.activeZone].tileset,this.display.mapTileset.tileSize=this.library.zones[this.game.world.activeZone].config.tilesets[0].tilewidth,this.display.mapTileset.columns=this.library.zones[this.game.world.activeZone].config.tilesets[0].columns,this.display.images=this.library.zones[this.game.world.activeZone].images.spriteSheet,this.display.imagesMap=this.library.zones[this.game.world.activeZone].images.spriteMap,this.display.adjustBufferCanvasSize(this.game.world.width,this.game.world.height)}}})}]);
//# sourceMappingURL=main.js.map