!function(i){var e={};function t(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return i[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=i,t.c=e,t.d=function(i,e,s){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:s})},t.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var r in i)t.d(s,r,function(e){return i[e]}.bind(null,r));return s},t.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="",t(t.s=7)}([function(i){i.exports=JSON.parse('{"frames":{"hud-0-hp":{"frame":{"x":0,"y":0,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-1-hp":{"frame":{"x":0,"y":11,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-2-hp":{"frame":{"x":0,"y":22,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"hud-3-hp":{"frame":{"x":0,"y":33,"w":56,"h":11},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":56,"h":11},"sourceSize":{"w":56,"h":11},"pivot":{"x":0.5,"y":0.5}},"bee-1":{"frame":{"x":0,"y":44,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-2":{"frame":{"x":37,"y":44,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-3":{"frame":{"x":56,"y":0,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-4":{"frame":{"x":0,"y":83,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-5":{"frame":{"x":37,"y":83,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-6":{"frame":{"x":93,"y":0,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-7":{"frame":{"x":74,"y":39,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"bee-8":{"frame":{"x":74,"y":78,"w":37,"h":39},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":39},"sourceSize":{"w":37,"h":39},"pivot":{"x":0.5,"y":0.5}},"player-climb-1":{"frame":{"x":0,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-climb-2":{"frame":{"x":37,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-climb-3":{"frame":{"x":74,"y":117,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-1":{"frame":{"x":130,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-2":{"frame":{"x":130,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-3":{"frame":{"x":111,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-duck-4":{"frame":{"x":111,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-1":{"frame":{"x":0,"y":154,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-2":{"frame":{"x":37,"y":154,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-3":{"frame":{"x":74,"y":149,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-fall-4":{"frame":{"x":111,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-hurt-1":{"frame":{"x":167,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-hurt-2":{"frame":{"x":167,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-1":{"frame":{"x":148,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-2":{"frame":{"x":148,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-3":{"frame":{"x":148,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-4":{"frame":{"x":0,"y":186,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-5":{"frame":{"x":37,"y":186,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-6":{"frame":{"x":74,"y":181,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-7":{"frame":{"x":111,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-8":{"frame":{"x":148,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-idle-9":{"frame":{"x":204,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-1":{"frame":{"x":204,"y":32,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-2":{"frame":{"x":185,"y":64,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-3":{"frame":{"x":185,"y":96,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-jump-4":{"frame":{"x":185,"y":128,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-1":{"frame":{"x":185,"y":160,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-2":{"frame":{"x":0,"y":218,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-3":{"frame":{"x":37,"y":218,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-4":{"frame":{"x":74,"y":213,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-5":{"frame":{"x":111,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-6":{"frame":{"x":148,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-7":{"frame":{"x":185,"y":192,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"player-skip-8":{"frame":{"x":241,"y":0,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}},"chest-1":{"frame":{"x":111,"y":224,"w":36,"h":25},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":36,"h":25},"sourceSize":{"w":36,"h":25},"pivot":{"x":0.5,"y":0.5}},"chest-2":{"frame":{"x":241,"y":32,"w":36,"h":25},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":36,"h":25},"sourceSize":{"w":36,"h":25},"pivot":{"x":0.5,"y":0.5}},"slug-skip-1":{"frame":{"x":147,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-2":{"frame":{"x":241,"y":57,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-3":{"frame":{"x":179,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"slug-skip-4":{"frame":{"x":211,"y":224,"w":32,"h":21},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":32,"h":21},"sourceSize":{"w":32,"h":21},"pivot":{"x":0.5,"y":0.5}},"enemy-death-1":{"frame":{"x":243,"y":78,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-2":{"frame":{"x":243,"y":107,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-3":{"frame":{"x":243,"y":136,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-4":{"frame":{"x":243,"y":165,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-5":{"frame":{"x":222,"y":194,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"enemy-death-6":{"frame":{"x":0,"y":250,"w":31,"h":29},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":31,"h":29},"sourceSize":{"w":31,"h":29},"pivot":{"x":0.5,"y":0.5}},"carrot-1":{"frame":{"x":111,"y":39,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-2":{"frame":{"x":222,"y":64,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-3":{"frame":{"x":222,"y":83,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"carrot-4":{"frame":{"x":222,"y":102,"w":17,"h":19},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":17,"h":19},"sourceSize":{"w":17,"h":19},"pivot":{"x":0.5,"y":0.5}},"star-1":{"frame":{"x":222,"y":121,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-2":{"frame":{"x":222,"y":134,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-3":{"frame":{"x":222,"y":147,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-4":{"frame":{"x":222,"y":160,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-5":{"frame":{"x":222,"y":173,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"star-6":{"frame":{"x":253,"y":194,"w":13,"h":13},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":13,"h":13},"sourceSize":{"w":13,"h":13},"pivot":{"x":0.5,"y":0.5}},"player-climb-4":{"frame":{"x":37,"y":122,"w":37,"h":32},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":32},"sourceSize":{"w":37,"h":32},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://free-tex-packer.com","version":"0.6.6","image":"sprites.png","format":"RGBA8888","size":{"w":278,"h":279},"scale":1}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":25,"height":15,"group":"characters","type":"enemy"},"main":{"jumpImpulse":221,"maxSpeed":0.75,"maxJumpingSpeed":9,"isJumping":false,"isJumpTriggered":false,"isFalling":true,"accelerationModifier":6,"brakingModifier":6,"velocityX":0,"velocityY":0,"climbingSpeed":0,"isMovingLeft":false,"isMovingRight":false,"friction":0.09,"isSprinting":false,"isDucking":false,"isKeepDucking":false,"isStuck":false,"isFacingLeft":false,"movingPattern":{"type":"roaming","length":130,"startingPoint":{"x":0,"y":0}}},"animation":{"frameWidth":32,"frameHeight":21,"animations":{"skip":{"delay":4,"frames":["slug-skip-1","slug-skip-2","slug-skip-3","slug-skip-4"]},"death":{"delay":2,"frames":["enemy-death-1","enemy-death-2","enemy-death-3","enemy-death-4","enemy-death-5","enemy-death-6"]}}}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":17,"height":19,"group":"collectables","type":"carrot"},"animation":{"frameWidth":17,"frameHeight":19,"animations":{"idle":{"delay":6,"frames":["carrot-1","carrot-2","carrot-3","carrot-4"]}}}}')},function(i){i.exports=JSON.parse('{"entity":{"id":null,"x":0,"y":0,"width":13,"height":13,"group":"collectables","type":"star"},"animation":{"frameWidth":13,"frameHeight":13,"animations":{"idle":{"delay":6,"frames":["star-1","star-2","star-3","star-4","star-5","star-6"]}}}}')},function(i){i.exports=JSON.parse('{"frames":{"house":{"frame":{"x":0,"y":0,"w":181,"h":157},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":181,"h":157},"sourceSize":{"w":181,"h":157},"pivot":{"x":0.5,"y":0.5}},"tree-2":{"frame":{"x":0,"y":157,"w":62,"h":108},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":62,"h":108},"sourceSize":{"w":62,"h":108},"pivot":{"x":0.5,"y":0.5}},"tree-1":{"frame":{"x":62,"y":157,"w":57,"h":77},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":57,"h":77},"sourceSize":{"w":57,"h":77},"pivot":{"x":0.5,"y":0.5}}},"meta":{"app":"http://free-tex-packer.com","version":"0.6.5","image":"images.png","format":"RGBA8888","size":{"w":181,"h":265},"scale":1}}')},function(i){i.exports=JSON.parse('{"0":{"x":0,"y":16,"w":3,"h":7,"m":4},"1":{"x":16,"y":16,"w":3,"h":7,"m":4},"2":{"x":32,"y":16,"w":3,"h":7,"m":4},"3":{"x":48,"y":16,"w":3,"h":7,"m":4},"4":{"x":64,"y":16,"w":3,"h":7,"m":4},"5":{"x":80,"y":16,"w":3,"h":7,"m":4},"6":{"x":96,"y":16,"w":3,"h":7,"m":4},"7":{"x":112,"y":16,"w":3,"h":7,"m":4},"8":{"x":128,"y":16,"w":3,"h":7,"m":4},"9":{"x":144,"y":16,"w":3,"h":7,"m":4}," ":{"x":0,"y":0,"w":2,"h":8,"m":4},"!":{"x":15,"y":0,"w":2,"h":8,"m":4},":":{"x":160,"y":16,"w":1,"h":7,"m":4},",":{"x":192,"y":0,"w":2,"h":8,"m":4},"-":{"x":208,"y":0,"w":3,"h":7,"m":4},".":{"x":224,"y":0,"w":2,"h":7,"m":4},"/":{"x":240,"y":0,"w":3,"h":7,"m":4},"A":{"x":16,"y":32,"w":3,"h":7,"m":4},"B":{"x":32,"y":32,"w":3,"h":7,"m":4},"C":{"x":48,"y":32,"w":3,"h":7,"m":4},"D":{"x":64,"y":32,"w":3,"h":7,"m":4},"E":{"x":80,"y":32,"w":3,"h":7,"m":4},"F":{"x":96,"y":32,"w":3,"h":7,"m":4},"G":{"x":112,"y":32,"w":3,"h":7,"m":4},"H":{"x":128,"y":32,"w":3,"h":7,"m":4},"I":{"x":144,"y":32,"w":3,"h":7,"m":4},"J":{"x":160,"y":32,"w":3,"h":7,"m":4},"K":{"x":176,"y":32,"w":3,"h":7,"m":4},"L":{"x":192,"y":32,"w":3,"h":7,"m":4},"M":{"x":208,"y":32,"w":5,"h":7,"m":4},"N":{"x":224,"y":32,"w":3,"h":7,"m":4},"O":{"x":240,"y":32,"w":3,"h":7,"m":4},"P":{"x":0,"y":48,"w":3,"h":7,"m":4},"Q":{"x":16,"y":48,"w":3,"h":7,"m":4},"R":{"x":32,"y":48,"w":3,"h":7,"m":4},"S":{"x":48,"y":48,"w":3,"h":7,"m":4},"T":{"x":64,"y":48,"w":3,"h":7,"m":4},"U":{"x":80,"y":48,"w":3,"h":7,"m":4},"V":{"x":96,"y":48,"w":3,"h":7,"m":4},"W":{"x":112,"y":48,"w":5,"h":7,"m":4},"X":{"x":128,"y":48,"w":3,"h":7,"m":4},"Y":{"x":144,"y":48,"w":3,"h":7,"m":4},"Z":{"x":160,"y":48,"w":3,"h":7,"m":4},"a":{"x":16,"y":64,"w":3,"h":7,"m":4},"b":{"x":32,"y":64,"w":3,"h":7,"m":4},"c":{"x":48,"y":64,"w":3,"h":7,"m":4},"d":{"x":64,"y":64,"w":3,"h":7,"m":4},"e":{"x":80,"y":64,"w":3,"h":7,"m":4},"f":{"x":96,"y":64,"w":3,"h":7,"m":4},"g":{"x":112,"y":64,"w":3,"h":9,"m":4},"h":{"x":128,"y":64,"w":3,"h":7,"m":4},"i":{"x":144,"y":64,"w":1,"h":7,"m":4},"j":{"x":160,"y":64,"w":2,"h":9,"m":4},"k":{"x":176,"y":64,"w":3,"h":7,"m":4},"l":{"x":192,"y":64,"w":2,"h":7,"m":4},"m":{"x":208,"y":64,"w":5,"h":7,"m":4},"n":{"x":224,"y":64,"w":3,"h":7,"m":4},"o":{"x":240,"y":64,"w":3,"h":7,"m":4},"p":{"x":0,"y":80,"w":3,"h":9,"m":4},"q":{"x":16,"y":80,"w":3,"h":9,"m":4},"r":{"x":32,"y":80,"w":3,"h":7,"m":4},"s":{"x":48,"y":80,"w":3,"h":7,"m":4},"t":{"x":64,"y":80,"w":3,"h":7,"m":4},"u":{"x":80,"y":80,"w":3,"h":7,"m":4},"v":{"x":96,"y":80,"w":3,"h":7,"m":4},"w":{"x":112,"y":80,"w":5,"h":7,"m":4},"x":{"x":128,"y":80,"w":3,"h":7,"m":4},"y":{"x":144,"y":80,"w":3,"h":9,"m":4},"z":{"x":160,"y":80,"w":3,"h":7,"m":4}}')},function(i){i.exports=JSON.parse('{"player":{"maxHealth":3},"entity":{"id":"","x":0,"y":0,"width":13,"height":20,"group":"characters","type":"player"},"main":{"jumpImpulse":100,"maxSpeed":3,"maxJumpingSpeed":9,"isJumping":false,"isJumpTriggered":false,"isFalling":true,"accelerationModifier":6,"brakingModifier":6,"velocityX":0,"velocityY":0,"climbingSpeed":2,"isMovingLeft":false,"isMovingRight":false,"friction":0.09,"isSprinting":false,"isDucking":false,"isKeepDucking":false,"isStuck":false,"isFacingLeft":false},"animation":{"frameWidth":37,"frameHeight":32,"animations":{"idle":{"delay":4,"frames":["player-idle-1","player-idle-2","player-idle-3","player-idle-4","player-idle-5","player-idle-6","player-idle-7","player-idle-8","player-idle-9"]},"skip":{"delay":2,"frames":["player-skip-1","player-skip-2","player-skip-3","player-skip-4","player-skip-5","player-skip-6","player-skip-7","player-skip-8"]},"jump":{"delay":4,"frames":["player-jump-1","player-jump-2","player-jump-3","player-jump-4"]},"fall":{"delay":4,"frames":["player-fall-1","player-fall-2","player-fall-3","player-fall-4"]},"duck":{"delay":4,"frames":["player-duck-1","player-duck-2","player-duck-3","player-duck-4"]},"hurt":{"delay":2,"frames":["player-hurt-1","player-hurt-2"]},"death":{"delay":2,"frames":["player-hurt-1","player-hurt-2"]},"climb":{"delay":2,"frames":["player-climb-1","player-climb-2","player-climb-3","player-climb-4"]}}}}')},function(i,e,t){"use strict";function s(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}t.r(e);var r=class{constructor(){s(this,"isActive",void 0),s(this,"isHold",void 0),this.isActive=!1,this.isHold=!1}getInput(i){switch(i){case"keydown":this.isActive&&(this.isHold=!0),this.isActive=!0;break;case"keyup":this.isActive=!1,this.isHold=!1}}};function a(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function o(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function h(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var n=class{constructor(i,e,t,s){switch(h(this,"vertexShader",void 0),h(this,"fragmentShader",void 0),h(this,"program",void 0),h(this,"aPosition",void 0),h(this,"aTextureCoord",void 0),h(this,"uResolution",void 0),h(this,"uColor",void 0),h(this,"uTranslation",void 0),h(this,"uScale",void 0),h(this,"uTexture",void 0),h(this,"positionBuffer",void 0),h(this,"textureCoordBuffer",void 0),h(this,"uTextureMatrix",void 0),this.vertexShader=this.compileShader(i,i.VERTEX_SHADER,e),this.fragmentShader=this.compileShader(i,i.FRAGMENT_SHADER,t),this.program=this.compileProgram(i),s){case"rectangle":this.aPosition=i.getAttribLocation(this.program,"aPosition"),this.uResolution=i.getUniformLocation(this.program,"uResolution"),this.uColor=i.getUniformLocation(this.program,"uColor");break;case"image":this.aPosition=i.getAttribLocation(this.program,"aPosition"),this.aTextureCoord=i.getAttribLocation(this.program,"aTextureCoord"),this.uResolution=i.getUniformLocation(this.program,"uResolution"),this.uTranslation=i.getUniformLocation(this.program,"uTranslation"),this.uScale=i.getUniformLocation(this.program,"uScale"),this.uTextureMatrix=i.getUniformLocation(this.program,"uTextureMatrix"),this.positionBuffer=i.createBuffer(),this.textureCoordBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.textureCoordBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),i.STREAM_DRAW)}}compileShader(i,e,t){var s=i.createShader(e);if(i.shaderSource(s,t),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(s));return s}compileProgram(i){var e=i.createProgram();if(i.attachShader(e,this.vertexShader),i.attachShader(e,this.fragmentShader),i.linkProgram(e),!i.getProgramParameter(e,i.LINK_STATUS))throw i.deleteProgram(e),e=null,new Error(i.getProgramInfoLog(e));return e}},l="\n    attribute vec4 aPosition;\n\n    uniform vec2 uResolution;\n\n    void main() {\n      // convert the position from pixels to clipspace\n      vec2 clipSpace = ((aPosition.xy / uResolution) * 2.0) - 1.0;\n\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n    }\n  ",c="\n    precision mediump float;\n\n    uniform vec4 uColor;\n\n    void main() {\n      gl_FragColor = uColor;\n    }\n  ",d="\n    attribute vec2 aPosition;\n    attribute vec2 aTextureCoord;\n\n    uniform vec2 uResolution;\n    uniform vec2 uTranslation;\n    uniform vec2 uScale;\n\n    uniform mat3 uTextureMatrix;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n      // Scale the position\n      vec2 scaledPosition = aPosition * uScale;\n\n      // Add in the translation.\n      vec2 position = scaledPosition + uTranslation;\n\n      // convert the position from pixels to clipspace\n      vec2 clipSpace = ((position / uResolution) * 2.0) - 1.0;\n\n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n      vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1)).xy;\n    }\n  ",m="\n    precision mediump float;\n\n    uniform sampler2D uTexture;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTextureCoord);\n    }\n  ";function u(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function p(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class g{constructor(i){this.bus=i,p(this,"width",236),p(this,"height",66),p(this,"xPadding",15),p(this,"yPadding",13),p(this,"offsetMax",70),p(this,"offsetStep",5),p(this,"background",void 0),p(this,"offset",70),p(this,"text",""),p(this,"fontSize",1),p(this,"resolve",void 0),p(this,"isResolved",!1),p(this,"isWaiting",!1),p(this,"isVisible",!1),p(this,"id",void 0),this.subscribeToEvents()}startWaiting(){this.bus.publish(this.bus.ENABLE_CONTROLS)}subscribeToEvents(){this.bus.subscribe(this.bus.SHOW_POPUP,this.callPopup.bind(this))}callPopup(i){return new Promise(e=>{this.isResolved=!1,this.isWaiting=!1,this.bus.publish(this.bus.DISABLE_CONTROLS),this.bus.publish(this.bus.FREEZE_CHARACTERS),this.isVisible=!0,"object"==typeof i?(this.text=i.text,i.fontSize?this.fontSize=i.fontSize:this.fontSize=1):(this.text=i,this.fontSize=1),this.id=this.bus.subscribe(this.bus.HIDE_POPUP,()=>this.startHiding(e))})}startHiding(i){this.bus.publish(this.bus.DISABLE_CONTROLS),this.bus.unsubscribe(this.bus.HIDE_POPUP,this.id),this.isVisible=!1,this.resolve=()=>{this.bus.publish(this.bus.UNFREEZE_CHARACTERS),this.bus.publish(this.bus.ENABLE_CONTROLS),i()}}}function f(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function y(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class v{constructor(i){y(this,"image",void 0),y(this,"tileSize",void 0),y(this,"columns",void 0),y(this,"flippedImage",void 0),y(this,"texture",void 0),y(this,"flippedTexture",void 0),y(this,"url",void 0),y(this,"gl",void 0),this.gl=i,this.image=new Image}loadAsset(i){var e,t=arguments,s=this;return(e=function*(){var e=t.length>1&&void 0!==t[1]&&t[1];s.url=i,e?(yield Promise.all([s.loadImage(i),s.flipImage(i)]),s.texture=s.createTexture(s.image),s.flippedTexture=s.createTexture(s.flippedImage)):(yield s.loadImage(i),s.texture=s.createTexture(s.image))},function(){var i=this,t=arguments;return new Promise((function(s,r){var a=e.apply(i,t);function o(i){f(a,s,r,o,h,"next",i)}function h(i){f(a,s,r,o,h,"throw",i)}o(void 0)}))})()}createTexture(i){var e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),e}loadImage(i){return new Promise((e,t)=>{this.image.addEventListener("load",()=>e()),this.image.addEventListener("error",i=>t(i)),this.image.src=i})}flipImage(i){return new Promise((e,t)=>{var s=document.createElement("canvas").getContext("2d"),r=new Image;r.src=i,r.addEventListener("error",i=>t(i)),r.addEventListener("load",()=>{s.canvas.width=r.width,s.canvas.height=r.height,s.save(),s.scale(-1,1),s.drawImage(r,-r.width,0,r.width,r.height),s.restore(),this.flippedImage=s.canvas,e()},{once:!0})})}}var w=t.p+"assets/images/clouds-back.png",x=t.p+"assets/images/clouds-front.png",b=t.p+"assets/images/bg-back.png",S=t.p+"assets/images/bg-front.png",z=t.p+"assets/images/default-tileset.png",T=t.p+"assets/images/sunny-land-tileset.png",C=t.p+"assets/images/images.png",P=t(4),A=t.p+"assets/images/sprites.png",M=t.p+"assets/images/popup.png",k=t.p+"assets/images/font.png";function R(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function F(i){return function(){var e=this,t=arguments;return new Promise((function(s,r){var a=i.apply(e,t);function o(i){R(a,s,r,o,h,"next",i)}function h(i){R(a,s,r,o,h,"throw",i)}o(void 0)}))}}function E(i){return L.apply(this,arguments)}function L(){return(L=F((function*(i){return(yield fetch(i)).json()}))).apply(this,arguments)}function O(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function D(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class B{constructor(i){D(this,"cloudsBack",void 0),D(this,"cloudsFront",void 0),D(this,"bgBack",void 0),D(this,"bgFront",void 0),D(this,"defaultTileSet",void 0),D(this,"sunnyLandTileSet",void 0),D(this,"defaultImages",void 0),D(this,"defaultImagesMap",void 0),D(this,"spriteSheet",void 0),D(this,"popup",void 0),D(this,"font",void 0),D(this,"zoneA0",void 0),D(this,"zoneA1",void 0),D(this,"zoneB0",void 0),D(this,"zoneB1",void 0),D(this,"zoneB2",void 0),D(this,"zoneB3",void 0),D(this,"loadingProgress",0),this.cloudsBack=new v(i),this.cloudsFront=new v(i),this.bgBack=new v(i),this.bgFront=new v(i),this.defaultTileSet=new v(i),this.sunnyLandTileSet=new v(i),this.defaultImages=new v(i),this.spriteSheet=new v(i),this.popup=new v(i),this.font=new v(i),this.defaultImagesMap=P}initAssets(){var i,e=this;return(i=function*(){return function(i,e){var t=0;for(var s of(e(0),i))s.then(()=>{t++,e(100*t/i.length)});return Promise.all(i)}([e.cloudsBack.loadAsset(w),e.cloudsFront.loadAsset(x),e.bgBack.loadAsset(b),e.bgFront.loadAsset(S),e.defaultTileSet.loadAsset(z),e.sunnyLandTileSet.loadAsset(T),e.defaultImages.loadAsset(C),e.spriteSheet.loadAsset(A,!0),e.popup.loadAsset(M),e.font.loadAsset(k),E("".concat("./assets","/levels/zoneA0.json")).then(i=>e.zoneA0=i),E("".concat("./assets","/levels/zoneA1.json")).then(i=>e.zoneA1=i),E("".concat("./assets","/levels/zoneB0.json")).then(i=>e.zoneB0=i),E("".concat("./assets","/levels/zoneB1.json")).then(i=>e.zoneB1=i),E("".concat("./assets","/levels/zoneB2.json")).then(i=>e.zoneB2=i),E("".concat("./assets","/levels/zoneB3.json")).then(i=>e.zoneB3=i)],i=>{e.loadingProgress=i})},function(){var e=this,t=arguments;return new Promise((function(s,r){var a=i.apply(e,t);function o(i){O(a,s,r,o,h,"next",i)}function h(i){O(a,s,r,o,h,"throw",i)}o(void 0)}))})()}get zones(){return{zoneA0:{config:this.zoneA0,tileset:this.defaultTileSet,backgrounds:[this.cloudsBack,this.cloudsFront,this.bgBack,this.bgFront],images:{spriteSheet:this.defaultImages,spriteMap:this.defaultImagesMap}},zoneA1:{config:this.zoneA1,tileset:this.defaultTileSet,backgrounds:[this.cloudsBack,this.cloudsFront],images:{spriteSheet:this.defaultImages,spriteMap:this.defaultImagesMap}},zoneB0:{config:this.zoneB0,tileset:this.sunnyLandTileSet,backgrounds:[],images:{}},zoneB1:{config:this.zoneB1,tileset:this.sunnyLandTileSet,backgrounds:[],images:{}},zoneB2:{config:this.zoneB2,tileset:this.sunnyLandTileSet,backgrounds:[],images:{}},zoneB3:{config:this.zoneB3,tileset:this.sunnyLandTileSet,backgrounds:[],images:{}}}}}var j=t(5);function I(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function _(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class H{constructor(i){_(this,"group",void 0),_(this,"type",void 0),_(this,"collisionType",null),_(this,"collisionXDirection",""),_(this,"collisionYDirection",""),_(this,"id",void 0),_(this,"properties",void 0),_(this,"defaults",void 0),_(this,"width",void 0),_(this,"height",void 0),_(this,"isVanished",!1),_(this,"x",void 0),_(this,"y",void 0),_(this,"xOld",void 0),_(this,"yOld",void 0),Object.assign(this,i),this.defaults=i,this.xOld=i.x,this.yOld=i.y}get top(){return this.y}set top(i){this.y=i}get right(){return this.x+this.width}set right(i){this.x=i-this.width}get bottom(){return this.y+this.height}set bottom(i){this.y=i-this.height}get left(){return this.x}set left(i){this.x=i}get oldTop(){return this.yOld}set oldTop(i){this.yOld=i}get oldRight(){return this.xOld+this.width}set oldRight(i){this.xOld=i-this.width}get oldBottom(){return this.yOld+this.height}set oldBottom(i){this.yOld=i-this.height}get oldLeft(){return this.xOld}set oldLeft(i){this.xOld=i}}function V(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var X=class{constructor(i,e,t,s){V(this,"spriteMap",void 0),V(this,"frameWidth",void 0),V(this,"frameHeight",void 0),V(this,"animations",void 0),V(this,"count",void 0),V(this,"delay",void 0),V(this,"mode",void 0),V(this,"activeFrameSet",void 0),V(this,"frameIndex",void 0),V(this,"frameValue",void 0),V(this,"flippedSpriteMap",void 0),this.spriteMap=i,this.flippedSpriteMap=i,this.frameWidth=e,this.frameHeight=t,this.animations=s,this.count=0,this.delay=0,this.activeFrameSet="",this.mode="pause",this.frameIndex=0,this.frameValue="",this.getXFlippedCoords()}animate(){switch(this.mode){case"loop":this.loop()}}changeFrameset(i,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"loop",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=i;this.animations[r]||(r=Object.keys(this.animations)[0]);var a=e||this.animations[r].delay;this.activeFrameSet===r&&a===this.delay||(this.count=0,this.delay=a,this.mode=t,this.activeFrameSet=r,this.frameIndex=s,this.frameValue=this.animations[r].frames[this.frameIndex])}getXFlippedCoords(){this.flippedSpriteMap=JSON.parse(JSON.stringify(this.spriteMap)),Object.keys(this.flippedSpriteMap.frames).map(i=>{this.flippedSpriteMap.frames[i].frame.x=this.flippedSpriteMap.meta.size.w-this.flippedSpriteMap.frames[i].frame.x-this.flippedSpriteMap.frames[i].frame.w})}loop(){this.count+=1,this.count>this.delay&&(this.count-=this.delay,this.frameIndex=this.frameIndex<this.animations[this.activeFrameSet].frames.length-1?this.frameIndex+1:0,this.frameValue=this.animations[this.activeFrameSet].frames[this.frameIndex])}};class U extends H{constructor(i,e){var t,s,r,{entity:a,animation:{frameWidth:o,frameHeight:h,animations:n}}=i;super(a),r=void 0,(s="animator")in(t=this)?Object.defineProperty(t,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[s]=r,this.setAnimationDefaults(o,h,n,e)}update(){this.updateAnimation()}setAnimationDefaults(i,e,t,s){this.animator=new X(s,i,e,t)}updateAnimation(){this.animator.changeFrameset("idle"),this.animator.animate()}}function J(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class Y extends H{constructor(i,e,t){var{entity:s,main:r,animation:{frameWidth:a,frameHeight:o,animations:h}}=e;super(s),this.bus=i,J(this,"isMovingLeft",void 0),J(this,"isMovingRight",void 0),J(this,"isJumpTriggered",void 0),J(this,"isJumping",void 0),J(this,"isFalling",void 0),J(this,"isSprinting",void 0),J(this,"isDucking",void 0),J(this,"isClimbing",void 0),J(this,"climbingDirection",void 0),J(this,"isHurtTriggered",void 0),J(this,"isHurt",void 0),J(this,"isDeathTriggered",!1),J(this,"isKeepDucking",void 0),J(this,"isFacingLeft",void 0),J(this,"isStuck",void 0),J(this,"velocityX",void 0),J(this,"velocityY",void 0),J(this,"animator",void 0),J(this,"movingPattern",void 0),J(this,"isJumpActive",void 0),J(this,"isUpActive",void 0),J(this,"isKeepJumping",void 0),J(this,"maxJumpingSpeed",void 0),J(this,"climbingSpeed",void 0),J(this,"maxSpeed",void 0),J(this,"accelerationModifier",void 0),J(this,"brakingModifier",void 0),J(this,"jumpImpulse",void 0),J(this,"velocityYModifier",void 0),J(this,"friction",void 0),J(this,"duckingTimer",void 0),J(this,"jumpingTimer",void 0),J(this,"isFreezed",!1),Object.assign(this,r),this.setAnimationDefaults(a,o,h,t),this.subscribeToEvents()}startMovingLeft(){this.isMovingRight||this.isDucking||this.isHurt||(this.isFacingLeft=!0,this.isMovingLeft=!0)}stopMovingLeft(){this.isMovingLeft=!1}startMovingRight(){this.isMovingLeft||this.isDucking||this.isHurt||(this.isFacingLeft=!1,this.isMovingRight=!0)}stopMovingRight(){this.isMovingRight=!1}startJumping(){this.isStuck||(this.isClimbing=!1,this.isJumping||(this.jumpingTimer=setTimeout(()=>{this.isKeepJumping=!0},100)),this.isJumpTriggered=!0)}stopJumping(){clearTimeout(this.jumpingTimer),this.isJumpTriggered=!1,this.isKeepJumping=!1}startDucking(){this.isJumping||this.isFalling||this.isHurt||(this.isDucking||(this.top+=5,this.duckingTimer=setTimeout(()=>{this.isKeepDucking=!0},1e3)),this.isDucking=!0,this.isSprinting=!1,this.isMovingLeft=!1,this.isMovingRight=!1,this.brakingModifier=24,this.height=15)}stopDucking(){this.isDucking=!1,this.isKeepDucking=!1,clearTimeout(this.duckingTimer),this.brakingModifier=6,this.height=20,this.top-=5}startSprinting(){this.isJumping||this.isDucking||this.isHurt||(this.isSprinting=!0,this.maxSpeed=5,this.accelerationModifier=10)}stopSprinting(){this.isSprinting=!1,this.maxSpeed=3,this.accelerationModifier=6}startClimbingAndMoving(i){this.climbingDirection=i}stopClimbingAndMoving(){this.climbingDirection=null}update(i){this.adjustHealth(),this.adjustHorizontalMovement(),this.adjustVerticalMovement(i),this.updateAnimation(),this.collisionType&&("ropes"!==this.collisionType||this.isClimbing)||(this.velocityY>0&&!this.isOnSurface&&(this.isFalling=!0),this.isClimbing=!1)}adjustHealth(){this.isDeathTriggered&&setTimeout(()=>{this.isVanished=!0},350)}freeze(){this.isFreezed=!0}unfreeze(){this.isFreezed=!1}subscribeToEvents(){this.bus.subscribe(this.bus.FREEZE_CHARACTERS,this.freeze.bind(this)),this.bus.subscribe(this.bus.UNFREEZE_CHARACTERS,this.unfreeze.bind(this))}get isOnSurface(){return this.top-this.oldTop<1}get isMoving(){return(this.isMovingLeft||this.isMovingRight)&&!this.isJumping&&!this.isFalling&&!this.isClimbing}get isBeganToDie(){return this.isDeathTriggered&&!this.isVanished}setAnimationDefaults(i,e,t,s){this.animator=new X(s,i,e,t)}updateAnimation(){this.isHurt?this.animator.changeFrameset("hurt"):this.isBeganToDie?this.animator.changeFrameset("death"):this.isMoving?this.isSprinting?this.animator.changeFrameset("skip",1.33):this.animator.changeFrameset("skip"):this.isFalling?this.animator.changeFrameset("fall"):this.isClimbing?this.climbingDirection?this.animator.changeFrameset("climb"):this.animator.changeFrameset("climb",30,"pause"):this.isJumping?this.animator.changeFrameset("jump"):this.isDucking?this.animator.changeFrameset("duck"):this.animator.changeFrameset("idle"),this.animator.animate()}adjustVerticalMovement(i){var e,t,s;if(!this.isFreezed&&("enemy"!==this.type||!this.isDeathTriggered))if(this.oldTop=this.top,this.isClimbing){switch(this.climbingDirection){case"up":this.velocityY=-this.climbingSpeed;break;case"down":this.velocityY=this.climbingSpeed;break;default:this.velocityY=0}this.top+=this.velocityY}else{var r=i;this.isKeepJumping&&this.velocityY<0?r*=.6:this.isKeepJumping=!1,this.velocityYModifier=r,!this.isJumpTriggered||this.isJumping||this.isFalling||(this.velocityYModifier-=this.jumpImpulse,this.isJumping=!0),this.velocityY=(e=this.velocityY+this.friction*this.velocityYModifier,t=-this.maxJumpingSpeed,s=this.maxJumpingSpeed,Math.max(t,Math.min(s,e))),this.top+=this.velocityY+this.friction*this.velocityY}}adjustHorizontalMovement(){if(!this.isFreezed&&!this.isDeathTriggered)if(this.oldLeft=this.left,this.isClimbing){switch(this.climbingDirection){case"left":this.velocityX=-this.climbingSpeed;break;case"right":this.velocityX=this.climbingSpeed;break;default:this.velocityX=0}this.left+=this.velocityX}else this.isMovingLeft?(this.velocityX>-this.maxSpeed&&(this.velocityX-=this.maxSpeed/this.accelerationModifier),this.velocityX<-this.maxSpeed&&(this.velocityX+=this.maxSpeed/this.accelerationModifier)):this.isMovingRight?(this.velocityX<this.maxSpeed&&(this.velocityX+=this.maxSpeed/this.accelerationModifier),this.velocityX>this.maxSpeed&&(this.velocityX-=this.maxSpeed/this.accelerationModifier)):this.isMovingLeft||this.isMovingRight||(this.velocityX<0&&(this.velocityX+=this.maxSpeed/this.brakingModifier,this.velocityX>0&&(this.velocityX=0)),this.velocityX>0&&(this.velocityX-=this.maxSpeed/this.brakingModifier,this.velocityX<0&&(this.velocityX=0))),this.left+=this.velocityX}}var N=t(0),Z=t(1),W=t(2),K=t(3);function G(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function q(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function Q(i){return function(){var e=this,t=arguments;return new Promise((function(s,r){var a=i.apply(e,t);function o(i){q(a,s,r,o,h,"next",i)}function h(i){q(a,s,r,o,h,"throw",i)}o(void 0)}))}}function $(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class ii extends Y{constructor(i,e,t,s){super(i,e,t),$(this,"destination",{name:"",x:0,y:0}),$(this,"currentHealth",void 0),$(this,"maxHealth",void 0),$(this,"currentStars",void 0),$(this,"maximumStars",void 0),this.maxHealth=e.player.maxHealth,this.currentHealth=this.maxHealth,this.currentStars=0,this.maximumStars=s}obtainStar(){this.currentStars+=1,this.currentStars===this.maximumStars&&this.bus.publish(this.bus.SHOW_POPUP,"Wow! You have collected all the stars!")}restoreHealth(){this.currentHealth<this.maxHealth&&(this.currentHealth+=1)}throwUp(i){switch(i){case"fromThePit":this.velocityY-=7;break;case"attacker":this.velocityY-=50,this.isUpActive&&(this.isKeepJumping=!0);break;case"left":this.top-=1,this.velocityY-=50,this.velocityX-=5;break;case"right":this.top-=1,this.velocityY-=50,this.velocityX+=5;break;case"death":this.top-=1,this.velocityY-=50,this.maxJumpingSpeed=11}}adjustHealth(){var i=this;this.isHurt&&(this.stopMovingLeft(),this.stopMovingRight()),this.isHurtTriggered&&(this.isHurtTriggered=!1,this.isHurt=!0,this.currentHealth-=1,this.currentHealth<=0?(this.isDeathTriggered=!0,this.throwUp("death"),setTimeout(Q((function*(){yield i.bus.publish(i.bus.SHOW_POPUP,{text:"YOU DIED",fontSize:6}),i.isVanished=!0,i.bus.publish(i.bus.APP_RESTART)})),1200)):(this.throwUp(this.collisionXDirection),setTimeout(()=>{this.isHurt=!1},1e3)))}}var ei=t(6);function ti(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var si=class{constructor(i,e,t){this.bus=i,ti(this,"objects",{}),ti(this,"player",void 0),ti(this,"spriteMap",void 0),ti(this,"world",void 0),ti(this,"maximumStars",14),ti(this,"zones",void 0),this.spriteMap=N,this.zones=e,this.player=this.createPlayer(),this.loadZone(t)}createPlayer(){return new ii(this.bus,ei,this.spriteMap,this.maximumStars)}loadZone(i){this.objects[i]=this.objects[i]||{},this.world=new class{constructor(i,e,t,s){this.bus=i,this.player=e,this.map=t,this.collection=s,G(this,"height",void 0),G(this,"width",void 0),G(this,"backgroundMap",void 0),G(this,"middleBackgroundMap",void 0),G(this,"middleFrontMap",void 0),G(this,"middleMap",void 0),G(this,"frontMap",void 0),G(this,"collisionDebugMap",void 0),G(this,"columns",void 0),G(this,"rows",void 0),G(this,"activeZone",void 0),G(this,"gravity",void 0),G(this,"tileSize",void 0),G(this,"collider",void 0),G(this,"rawLayers",void 0),G(this,"doors",void 0),G(this,"collisions",void 0),G(this,"brain",void 0),G(this,"ropes",void 0),this.gravity=10,this.columns=t.width,this.rows=t.height,this.tileSize=t.tilewidth,this.width=this.columns*this.tileSize,this.height=this.rows*this.tileSize,this.player=e,this.brain=new class{constructor(){var i,e,t;t=void 0,(e="characters")in(i=this)?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,this.characters=[]}bindCharacter(i){this.characters.push({character:i,startingPoint:i.movingPattern.startingPoint,reachedLeftBorder:!1,reachedRightBorder:!1})}update(){this.checkBroadPhase()}checkBroadPhase(){for(var i=0;i<this.characters.length;i+=1)if(this.characters[i].character.movingPattern)switch(this.characters[i].character.movingPattern.type){case"roaming":this.processRoaming(i)}}processRoaming(i){var{character:e,startingPoint:t,reachedLeftBorder:s,reachedRightBorder:r}=this.characters[i],a=e.left>t.x-e.movingPattern.length,o=e.left<e.movingPattern.length+t.x,h="left"!==e.collisionXDirection,n="right"!==e.collisionXDirection,l=e.left<t.x-e.movingPattern.length,c=e.left>e.movingPattern.length+t.x;!s&&!r||!s&&r?a&&h?(e.stopMovingRight(),e.startMovingLeft(),e.collisionXDirection=""):c?(e.stopMovingLeft(),e.startMovingRight()):(this.characters[i].reachedLeftBorder=!0,this.characters[i].reachedRightBorder=!1):s&&!r&&(o&&n?(e.stopMovingLeft(),e.startMovingRight(),e.collisionXDirection=""):l?(e.stopMovingRight(),e.startMovingLeft()):(this.characters[i].reachedRightBorder=!0,this.characters[i].reachedLeftBorder=!1))}},this.processMap(this.map),this.collider=new class{constructor(i){this.bus=i}processBroadPhase(i){return this.bruteForce(i)}routeCharacterVsCollision(i,e){switch(i.isStuck=!1,e.type){case"top":this.isCollidingFromTop(i,e)&&this.collideCharacterVsCollisionFromTop(i,e);break;case"right":this.isCollidingFromRight(i,e)&&this.collideCharacterVsCollisionFromRight(i,e);break;case"bottom":this.isCollidingFromBottom(i,e)&&this.collideCharacterVsCollisionFromBottom(i,e);break;case"left":this.isCollidingFromLeft(i,e)&&this.collideCharacterVsCollisionFromLeft(i,e);break;case"top-left":if(this.isCollidingFromTop(i,e))return void this.collideCharacterVsCollisionFromTop(i,e);this.isCollidingFromLeft(i,e)&&this.collideCharacterVsCollisionFromLeft(i,e);break;case"top-right":if(this.isCollidingFromTop(i,e))return void this.collideCharacterVsCollisionFromTop(i,e);this.isCollidingFromRight(i,e)&&this.collideCharacterVsCollisionFromRight(i,e);break;case"bottom-right":if(this.isCollidingFromRight(i,e))return void this.collideCharacterVsCollisionFromRight(i,e);this.isCollidingFromBottom(i,e)&&this.collideCharacterVsCollisionFromBottom(i,e);break;case"bottom-left":if(this.isCollidingFromLeft(i,e))return void this.collideCharacterVsCollisionFromLeft(i,e);this.isCollidingFromBottom(i,e)&&this.collideCharacterVsCollisionFromBottom(i,e);break;case"full":if(this.isCollidingFromTop(i,e))return void this.collideCharacterVsCollisionFromTop(i,e);if(this.isCollidingFromLeft(i,e))return void this.collideCharacterVsCollisionFromLeft(i,e);if(this.isCollidingFromRight(i,e))return void this.collideCharacterVsCollisionFromRight(i,e);this.isCollidingFromBottom(i,e)&&this.collideCharacterVsCollisionFromBottom(i,e),i.isStuck=!0}}routePlayerVsDoor(i,e){var{target:t}=e.properties,s=parseInt(e.properties.offset),r=e.properties.destinationX?parseInt(e.properties.destinationX):null,a=e.properties.destinationY?parseInt(e.properties.destinationY):null,o={};"vertical"===e.type?(this.isCollidingFromLeft(i,e)?o.x=r:o.x=r-i.width,o.y=i.top+s):(this.isCollidingFromTop(i,e)?o.y=a:(o.y=a-i.height,i.throwUp("fromThePit")),o.x=i.left+s),o.name=t,this.bus.publish(this.bus.LOAD_ZONE,o)}routePlayerVsEnemy(i,e){if(!e.isVanished)return this.isCollidingFromTop(i,e)||this.isCollidingFromBottom(e,i)?(e.isDeathTriggered=!0,void i.throwUp("attacker")):void(this.isCollidingFromRight(i,e)||this.isCollidingFromBottom(i,e)||this.isCollidingFromTop(e,i)||this.isCollidingFromLeft(e,i)?(i.collisionXDirection="right",i.isHurtTriggered=!0):(this.isCollidingFromLeft(i,e)||this.isCollidingFromRight(e,i))&&(i.collisionXDirection="left",i.isHurtTriggered=!0))}routePlayerVsCollectable(i,e){if(!e.isVanished)switch(e.type){case"carrot":e.isVanished=!0,i.restoreHealth();break;case"star":e.isVanished=!0,i.obtainStar()}}routePlayerVsRope(i){i.isUpActive&&(i.isClimbing=!0,i.isJumping=!1,i.isFalling=!1)}isCollidingFromTop(i,e){return i.bottom>e.top&&i.oldBottom<=e.top}isCollidingFromRight(i,e){return i.left<e.right&&i.oldLeft>=e.right}isCollidingFromBottom(i,e){return i.top<e.bottom&&i.oldTop>=e.bottom}isCollidingFromLeft(i,e){return i.right>e.left&&i.oldRight<=e.left}bruteForce(i){var e=i.length,t=[];if(e>1)for(var s=0;s<e;s+=1)for(var r=i[s],a=s+1;a<e;a+=1){var o=i[a];this.broadPhaseComparator(r,o)?(this.broadPhaseResolver(r,o),t.push([r,o]),r.collisionType=o.group,o.collisionType=r.group):(r.collisionType=null,o.collisionType=null)}return t}broadPhaseComparator(i,e){return("characters"===i.group||"characters"===e.group)&&(i.left<e.right&&e.left<i.right&&i.top<e.bottom&&e.top<i.bottom)}broadPhaseResolver(i,e){i.isDeathTriggered||e.isDeathTriggered||("characters"===i.group&&"collisions"===e.group?this.routeCharacterVsCollision(i,e):"characters"===i.group&&"characters"===e.group?"player"===i.type&&"enemy"===e.type&&this.routePlayerVsEnemy(i,e):"characters"===i.group&&"doors"===e.group?"player"===i.type&&this.routePlayerVsDoor(i,e):"characters"===i.group&&"collectables"===e.group?"player"===i.type&&this.routePlayerVsCollectable(i,e):"characters"===i.group&&"ropes"===e.group&&"player"===i.type&&this.routePlayerVsRope(i))}collideCharacterVsCollisionFromTop(i,e){i.bottom=e.top-.01,i.velocityY=0,i.isJumping=!1,i.isFalling=!1,i.collisionYDirection="bottom",e.collisionYDirection="top"}collideCharacterVsCollisionFromRight(i,e){i.left=e.right,i.velocityX=0,i.collisionXDirection="left",e.collisionXDirection="right"}collideCharacterVsCollisionFromBottom(i,e){i.top=e.bottom,i.velocityY=0,i.isJumping=!1,i.isFalling=!0,i.collisionYDirection="top",e.collisionYDirection="bottom"}collideCharacterVsCollisionFromLeft(i,e){i.right=e.left-.01,i.velocityX=0,i.collisionXDirection="right",e.collisionXDirection="left"}}(i)}update(){this.collection.characters.forEach(i=>{i.isVanished||(i.update(this.gravity),this.processBoundariesCollision(i))}),this.collection.collectables.forEach(i=>{i.isVanished||i.update()});var i=this.collider.processBroadPhase([...this.collection.characters,...this.collisions,...this.doors,...this.collection.collectables,...this.ropes]);this.collisionDebugMap=i,this.brain.update()}fillMapLayer(i){return i.objects.map(e=>new H({x:e.x,y:e.y,width:e.width,height:e.height,group:i.name,type:e.type,properties:e.properties?e.properties.reduce((i,e)=>(i[e.name]=e.value,i),{}):{}}))}processMap(i){this.collection.collectables=this.collection.collectables||[],this.collection.characters=this.collection.characters||[],this.rawLayers=i.layers.reduce((i,e)=>{var t,s;switch(e.name){case"tiles":e.layers.forEach(e=>i[e.name]=e.data);break;case"objects":e.layers.forEach(e=>{switch(e.name){case"collisions":case"doors":case"ropes":i[e.name]=this.fillMapLayer(e);break;case"collectables":i[e.name]=e.objects.map((i,e)=>{switch(i.type){case"carrot":return t="carrot_".concat(e),(s=this.collection.collectables.filter(i=>i.id===t)[0])||(W.entity.id=t,W.entity.x=i.x,W.entity.y=i.y,new U(W,N));case"star":return t="star_".concat(e),(s=this.collection.collectables.filter(i=>i.id===t)[0])||(K.entity.id=t,K.entity.x=i.x,K.entity.y=i.y,new U(K,N))}});break;case"characters":i[e.name]=e.objects.map((i,e)=>{switch(i.type){case"player":return this.player.destination.name.length?(this.player.left=this.player.destination.x,this.player.top=this.player.destination.y):(this.player.left=i.x,this.player.top=i.y),this.player;case"enemy":switch(i.name){case"slug":if(t="slug_".concat(e),!(s=this.collection.characters.filter(i=>i.id===t)[0])){Z.entity.id=t,Z.entity.x=i.x,Z.entity.y=i.y,Z.main.movingPattern.startingPoint={x:i.x,y:i.y};var r=new Y(this.bus,Z,N);return this.brain.bindCharacter(r),r}return s.movingPattern.startingPoint={x:i.x,y:i.y},this.brain.bindCharacter(s),s}}})}})}return i},{}),this.backgroundMap=[...this.rawLayers.background],this.rawLayers["middle-background"]&&(this.middleBackgroundMap=[...this.rawLayers["middle-background"]]),this.middleMap=[...this.rawLayers.middle],this.rawLayers["middle-front"]&&(this.middleFrontMap=[...this.rawLayers["middle-front"]]),this.frontMap=[...this.rawLayers.front],this.collisions=[...this.rawLayers.collisions],this.collection.characters=[...this.rawLayers.characters],this.doors=[...this.rawLayers.doors],this.ropes=this.rawLayers.ropes?[...this.rawLayers.ropes]:[],this.collection.collectables=this.rawLayers.collectables?[...this.rawLayers.collectables]:[],this.collisionDebugMap=[]}processBoundariesCollision(i){i.isDeathTriggered||(i.left<0&&(i.left=0,i.velocityX=0),i.left+i.width>this.width&&(i.left=this.width-i.width,i.velocityX=0),i.top<0&&(i.top=0,i.velocityY=0),i.top+i.height>this.height&&(i.isJumping=!1,i.top=this.height-i.height,i.velocityY=0))}}(this.bus,this.player,this.zones[i].config,this.objects[i]),this.world.activeZone=i}update(){this.world.update()}};function ri(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function ai(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function oi(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function hi(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class ni{constructor(){hi(this,"FREEZE_CHARACTERS","character.freeze"),hi(this,"UNFREEZE_CHARACTERS","character.unfreeze"),hi(this,"SHOW_POPUP","popup.callPopup"),hi(this,"HIDE_POPUP","popup.startHiding"),hi(this,"DISABLE_CONTROLS","app.disableControls"),hi(this,"ENABLE_CONTROLS","app.enableControls"),hi(this,"LOAD_ZONE","app.loadZone"),hi(this,"APP_RESTART","app.restart"),hi(this,"subscriptions",{}),hi(this,"lastId",0)}subscribe(i,e){var t=this.getId();return this.subscriptions[i]||(this.subscriptions[i]={}),this.subscriptions[i][t]=e,t}unsubscribe(i,e){delete this.subscriptions[i][e]}publish(i,e){var t,s=this;return(t=function*(){if(s.subscriptions[i]){var t=Object.keys(s.subscriptions[i]);for(var r of t)yield s.subscriptions[i][r](e)}},function(){var i=this,e=arguments;return new Promise((function(s,r){var a=t.apply(i,e);function o(i){oi(a,s,r,o,h,"next",i)}function h(i){oi(a,s,r,o,h,"throw",i)}o(void 0)}))})()}getId(){return this.lastId+=1,"".concat(this.lastId)}}function li(i,e,t,s,r,a,o){try{var h=i[a](o),n=h.value}catch(i){return void t(i)}h.done?e(n):Promise.resolve(n).then(s,r)}function ci(i){return function(){var e=this,t=arguments;return new Promise((function(s,r){var a=i.apply(e,t);function o(i){li(a,s,r,o,h,"next",i)}function h(i){li(a,s,r,o,h,"throw",i)}o(void 0)}))}}function di(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}window.addEventListener("DOMContentLoaded",()=>{new class{constructor(){di(this,"aspectRatio",9/16),di(this,"fps",1e3/30),di(this,"startingZone","zoneA1"),di(this,"controller",void 0),di(this,"game",void 0),di(this,"display",void 0),di(this,"engine",void 0),di(this,"bus",void 0),di(this,"areControlsDisabled",!1),di(this,"state",void 0),this.init()}restart(){this.game=new si(this.bus,this.display.library.zones,this.startingZone),this.updateZoneAssets()}init(){var i=this;return ci((function*(){i.bus=new ni,i.controller=new class{constructor(){a(this,"left",void 0),a(this,"right",void 0),a(this,"up",void 0),a(this,"shift",void 0),a(this,"down",void 0),a(this,"jump",void 0),this.left=new r,this.right=new r,this.up=new r,this.shift=new r,this.down=new r,this.jump=new r}get isAnyKeyIsActive(){return this.left.isActive||this.right.isActive||this.up.isActive||this.shift.isActive||this.up.isActive||this.down.isActive||this.jump.isActive}handleKeyEvent(i,e){switch(e){case 37:this.left.getInput(i);break;case 38:this.up.getInput(i);break;case 39:this.right.getInput(i);break;case 16:this.shift.getInput(i);break;case 40:this.down.getInput(i);break;case 90:this.jump.getInput(i)}}},i.display=new class{constructor(i,e,t,s){this.bus=i,I(this,"context",void 0),I(this,"camera",void 0),I(this,"renderer",void 0),I(this,"buffer",void 0),I(this,"imagesMap",void 0),I(this,"popup",void 0),I(this,"library",void 0),I(this,"backgrounds",void 0),I(this,"mapTileset",void 0),I(this,"images",void 0),this.context=e.getContext("2d"),this.buffer=document.createElement("canvas").getContext("webgl"),this.backgrounds=[],this.camera=new class{constructor(i,e){o(this,"x",void 0),o(this,"y",void 0),o(this,"width",void 0),o(this,"height",void 0),o(this,"yDiff",void 0),o(this,"velocity",void 0),o(this,"velocityModifier",void 0),o(this,"maxVelocity",void 0),this.x=0,this.y=0,this.width=i,this.height=e,this.yDiff=0,this.velocity=0,this.velocityModifier=4,this.maxVelocity=this.height/2.5}adjustCamera(i,e,t){if(!i.isDeathTriggered){var s;i.isDucking?(s=i.top-(i.defaults.height-i.height)+this.velocity,i.isKeepDucking&&this.velocity<=this.maxVelocity&&(this.velocity+=this.velocityModifier)):(this.velocity&&(this.velocity-=this.velocityModifier),s=i.top+this.velocity);var r=i.left+i.defaults.width/2,a=s+i.defaults.height/2,o=r-this.width/2,h=a-this.height/2;o<0&&(o=0),r+this.width/2>e&&(o=e-this.width),h<0&&(h=0),a+this.height/2>t&&(h=t-this.height),this.x=Math.round(o),this.y=Math.round(h)}}}(t,s),this.renderer=new class{constructor(i){u(this,"gl",void 0),u(this,"rectangleProgram",void 0),u(this,"imageProgram",void 0),u(this,"aPosition",void 0),u(this,"uResolution",void 0),u(this,"uColor",void 0),this.gl=i,this.rectangleProgram=new n(this.gl,l,c,"rectangle"),this.imageProgram=new n(this.gl,d,m,"image")}drawRect(i,e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.gl.createBuffer()),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.gl.DYNAMIC_DRAW),this.gl.useProgram(this.rectangleProgram.program),this.gl.enableVertexAttribArray(this.rectangleProgram.aPosition),this.gl.vertexAttribPointer(this.rectangleProgram.aPosition,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.rectangleProgram.uResolution,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform4f(this.rectangleProgram.uColor,e[0]/255,e[1]/255,e[2]/255,e[3]),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}drawImage(i,e,t,s,r,a,o,h,n,l,c){void 0===h&&(h=s),void 0===n&&(n=r),void 0===a&&(a=e),void 0===o&&(o=t),void 0===l&&(l=a),void 0===c&&(c=o),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.useProgram(this.imageProgram.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.imageProgram.positionBuffer),this.gl.enableVertexAttribArray(this.imageProgram.aPosition),this.gl.vertexAttribPointer(this.imageProgram.aPosition,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.imageProgram.textureCoordBuffer),this.gl.enableVertexAttribArray(this.imageProgram.aTextureCoord),this.gl.vertexAttribPointer(this.imageProgram.aTextureCoord,2,this.gl.FLOAT,!1,0,0),this.gl.uniform2f(this.imageProgram.uResolution,this.gl.canvas.width,this.gl.canvas.height),this.gl.uniform2f(this.imageProgram.uTranslation,h,n),this.gl.uniform2f(this.imageProgram.uScale,l,c);var d=this.translation(s/e,r/t);d=this.scale(d,a/e,o/t),this.gl.uniformMatrix3fv(this.imageProgram.uTextureMatrix,!1,d),this.gl.uniform1i(this.imageProgram.uTexture,0),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}translation(i,e){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=i,t[7]=e,t[8]=1,t}scale(i,e,t){var s=new Float32Array(9);return s[0]=e*i[0],s[1]=e*i[1],s[2]=e*i[2],s[3]=t*i[3],s[4]=t*i[4],s[5]=t*i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s}clear(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}(this.buffer),this.popup=new g(this.bus),this.library=new B(this.buffer)}adjustBufferCanvasSize(i,e){this.buffer.canvas.width=i,this.buffer.canvas.height=e}drawLoading(){var i=this.camera.width/100*this.library.loadingProgress,e=this.camera.width/2-i/2;this.renderer.drawRect([e,this.camera.height/2-10,e+i,this.camera.height/2-10,e,this.camera.height/2+10,e,this.camera.height/2+10,e+i,this.camera.height/2-10,e+i,this.camera.height/2+10],[255,255,255,1])}drawPopup(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:68;!this.popup.isVisible&&this.popup.offset>this.popup.offsetMax?this.popup.resolve&&!this.popup.isResolved&&(this.popup.resolve(),this.popup.isResolved=!0):(this.popup.isVisible&&this.popup.offset>0?this.popup.offset-=this.popup.offsetStep:this.popup.isVisible?this.popup.startWaiting&&!this.popup.isWaiting&&(this.popup.startWaiting(),this.popup.isWaiting=!0):this.popup.offset+=this.popup.offsetStep,this.drawObject(!1,this.library.popup,0,0,this.camera.x+i,this.camera.y+e+this.popup.offset,this.popup.width,this.popup.height),this.drawText(this.popup.text,i+this.popup.xPadding,e+this.popup.yPadding+this.popup.offset,"left",this.popup.fontSize))}drawText(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=t,o=j,h=i.split(""),n=0;"right"===s&&(h=h.reverse());for(var l=0;l<h.length;l+=1)if("|"!==h[l]){var c=o[h[l]],d=h[l-1]&&"|"!==h[l-1]?o[h[l-1]].w:0;l&&(n+=d+1);var m=this.camera.x+e+n*r;"right"===s&&(m=this.camera.x+e-n*r),this.drawObject(!1,this.library.font,c.x,c.y+c.m,m,this.camera.y+a,c.w,c.h,c.w*r,c.h*r)}else a+=11,n=-1}drawCharacters(i){i.forEach(i=>{var e;i.isVanished||(e=i.isFacingLeft?i.animator.flippedSpriteMap.frames[i.animator.frameValue].frame:i.animator.spriteMap.frames[i.animator.frameValue].frame,this.drawObject(i.isFacingLeft,this.library.spriteSheet,e.x,e.y,i.left+Math.floor(.5*i.width-.5*e.w),i.top-Math.floor(e.h-i.height),e.w,e.h))})}drawCollectables(i){i.forEach(i=>{if(!i.isVanished){var e=i.animator.spriteMap.frames[i.animator.frameValue].frame;this.drawObject(!1,this.library.spriteSheet,e.x,e.y,i.left,i.top,e.w,e.h)}})}drawHud(i,e){var t=e.frames["hud-".concat(i.currentHealth,"-hp")];if(t){var{frame:s}=t;this.drawObject(!1,this.library.spriteSheet,s.x,s.y,this.camera.x+2,this.camera.y+2,s.w,s.h),this.drawText("".concat(i.currentStars),52,4,"right")}}drawObject(i,e,t,s,r,a,o,h,n,l){void 0===n&&(n=o),void 0===l&&(l=h),this.isObjectWithinCamera(r,a)&&this.renderer.drawImage(i?e.flippedTexture:e.texture,e.image.width,e.image.height,t,s,o,h,Math.round(r),Math.round(a),n,l)}drawBackgrounds(){for(var i=0;i<this.backgrounds.length;i+=1){var e=0,t=0,s=i+1;for(e+=this.camera.x/(6*s),t+=this.camera.y/(10.66*s),this.renderer.drawImage(this.backgrounds[i].texture,this.backgrounds[i].image.width,this.backgrounds[i].image.height,0,0,this.backgrounds[i].image.width,this.backgrounds[i].image.height,e,t,this.backgrounds[i].image.width,this.backgrounds[i].image.height);e+this.backgrounds[i].image.width<=this.camera.x+this.camera.width;)e+=this.backgrounds[i].image.width,this.renderer.drawImage(this.backgrounds[i].texture,this.backgrounds[i].image.width,this.backgrounds[i].image.height,0,0,this.backgrounds[i].image.width,this.backgrounds[i].image.height,e,t,this.backgrounds[i].image.width,this.backgrounds[i].image.height)}}drawCollisionDebugMap(i){for(var e={top:[255,0,0,.5],"top-left":[255,100,0,.5],"top-right":[255,0,136,.5],left:[0,181,204,.5],right:[145,61,136,.5],bottom:[255,255,0,.5],"bottom-left":[255,255,204,.5],"bottom-right":[255,255,136,.5],full:[200,200,200,.5]},t=0;t<i.length;t+=1)for(var s=0;s<i[t].length;s+=1)"collisions"===i[t][s].group&&this.renderer.drawRect([i[t][s].x,i[t][s].y,i[t][s].x+i[t][s].width,i[t][s].y,i[t][s].x,i[t][s].y+i[t][s].height,i[t][s].x,i[t][s].y+i[t][s].height,i[t][s].x+i[t][s].width,i[t][s].y,i[t][s].x+i[t][s].width,i[t][s].y+i[t][s].height],e[i[t][s].type])}drawMap(i,e,t){for(var s=0;s<i.length;s+=1)if(i[s]){var r=i[s],a=s,o=r%this.mapTileset.columns,h=o?Math.floor(r/this.mapTileset.columns):r/this.mapTileset.columns-1,n=o?o-1:this.mapTileset.columns-1,l=Math.floor(a/e),c=a%e,d=this.mapTileset.tileSize*n,m=this.mapTileset.tileSize*h,u=this.mapTileset.tileSize*c,p=this.mapTileset.tileSize*l;t&&r>=t.firstgid&&this.drawLargeTiles(t,r,u,p),this.isObjectWithinCamera(u,p)&&this.renderer.drawImage(this.mapTileset.texture,this.mapTileset.image.width,this.mapTileset.image.height,d,m,this.mapTileset.tileSize,this.mapTileset.tileSize,u,p,this.mapTileset.tileSize,this.mapTileset.tileSize)}}render(){this.context.drawImage(this.buffer.canvas,this.camera.x,this.camera.y,this.camera.width,this.camera.height,0,0,this.context.canvas.width,this.context.canvas.height)}resize(i,e,t){e/i>t?(this.context.canvas.height=i*t,this.context.canvas.width=i):(this.context.canvas.height=e,this.context.canvas.width=e/t),this.context.imageSmoothingEnabled=!1}isObjectWithinCamera(i,e,t,s){void 0===t&&(t=i),void 0===s&&(s=e);var r=2*this.mapTileset.tileSize;return!(e>this.camera.y+this.camera.height+r||s<this.camera.y-r||i>this.camera.x+this.camera.width+r||t<this.camera.x-r)}drawLargeTiles(i,e,t,s){var r=i.tiles[e-i.firstgid],a=this.imagesMap.frames[r.type],o=t,h=s-(a.frame.h-this.mapTileset.tileSize);this.isObjectWithinCamera(o,h,o+a.frame.w,h+a.frame.h)&&this.renderer.drawImage(this.images.texture,this.images.image.width,this.images.image.height,a.frame.x,a.frame.y,a.frame.w,a.frame.h,o,h,a.frame.w,a.frame.h)}}(i.bus,document.getElementById("game"),256,144),i.engine=new class{constructor(i,e,t){ai(this,"render",void 0),ai(this,"update",void 0),ai(this,"animationFrame",void 0),ai(this,"handleRun",void 0),ai(this,"timeStep",void 0),ai(this,"accumulatedTime",void 0),ai(this,"previousTime",void 0),ai(this,"isUpdated",void 0),this.update=t,this.render=e,this.animationFrame=()=>{},this.handleRun=()=>{},this.timeStep=i,this.previousTime=0,this.accumulatedTime=0,this.isUpdated=!1}run(i){var e,t=this;return(e=function*(){for(t.animationFrame=window.requestAnimationFrame(t.handleRun),t.accumulatedTime+=i-t.previousTime,t.previousTime=i,t.accumulatedTime>=3*t.timeStep&&(t.accumulatedTime=t.timeStep);t.accumulatedTime>=t.timeStep;)t.accumulatedTime-=t.timeStep,yield t.update(t.timeStep),t.isUpdated=!0;t.isUpdated&&(t.isUpdated=!1,t.render())},function(){var i=this,t=arguments;return new Promise((function(s,r){var a=e.apply(i,t);function o(i){ri(a,s,r,o,h,"next",i)}function h(i){ri(a,s,r,o,h,"throw",i)}o(void 0)}))})()}start(){this.accumulatedTime=this.timeStep,this.previousTime=window.performance.now(),this.animationFrame=window.requestAnimationFrame(this.handleRun=this.run.bind(this))}stop(){window.cancelAnimationFrame(this.animationFrame)}}(i.fps,i.render.bind(i),i.update.bind(i)),i.subscribeToEvents(),i.state="loading",i.resize(),i.engine.start(),yield i.display.library.initAssets(),i.game=new si(i.bus,i.display.library.zones,i.startingZone),i.display.buffer.canvas.height=i.game.world.height,i.display.buffer.canvas.width=i.game.world.width,i.state="game",i.updateZoneAssets(),setTimeout(ci((function*(){i.bus.publish(i.bus.SHOW_POPUP,"Welcome!|Movement: arrow buttons. Jump: Z. Sprint: Shift.|Find some stars! Eat lots of carrots!")})),300)}))()}subscribeToEvents(){window.addEventListener("keydown",this.handleKeyEvent.bind(this)),window.addEventListener("keyup",this.handleKeyEvent.bind(this)),window.addEventListener("resize",this.resize.bind(this)),this.bus.subscribe(this.bus.DISABLE_CONTROLS,this.disableControls.bind(this)),this.bus.subscribe(this.bus.ENABLE_CONTROLS,this.enableControls.bind(this)),this.bus.subscribe(this.bus.LOAD_ZONE,this.loadZone.bind(this)),this.bus.subscribe(this.bus.APP_RESTART,this.restart.bind(this))}disableControls(){this.areControlsDisabled=!0}enableControls(){this.areControlsDisabled=!1}handleKeyEvent(i){this.controller.handleKeyEvent(i.type,i.keyCode)}adjustMovingControls(){this.controller.left.isActive?this.game.player.startMovingLeft():this.game.player.isMovingLeft&&this.game.player.stopMovingLeft(),this.controller.right.isActive?this.game.player.startMovingRight():this.game.player.isMovingRight&&this.game.player.stopMovingRight(),this.controller.jump.isActive&&!this.controller.jump.isHold?this.game.player.startJumping():this.game.player.isJumpTriggered&&this.game.player.stopJumping(),this.controller.shift.isActive?this.game.player.startSprinting():this.game.player.isSprinting&&this.game.player.stopSprinting(),this.controller.down.isActive?this.game.player.startDucking():this.game.player.isDucking&&this.game.player.stopDucking()}adjustClimbingControls(){this.controller.up.isActive||this.controller.right.isActive||this.controller.down.isActive||this.controller.left.isActive||this.game.player.stopClimbingAndMoving(),this.controller.left.isActive&&this.game.player.startClimbingAndMoving("left"),this.controller.right.isActive&&this.game.player.startClimbingAndMoving("right"),this.controller.down.isActive&&this.game.player.startClimbingAndMoving("down"),this.controller.up.isActive&&this.game.player.startClimbingAndMoving("up"),!this.controller.jump.isActive||this.controller.jump.isHold||this.game.player.climbingDirection?this.game.player.isJumpTriggered&&this.game.player.stopJumping():this.game.player.startJumping()}resize(){this.display.resize(document.documentElement.clientWidth,document.documentElement.clientHeight,this.aspectRatio),this.display.render(),this.game&&this.display.camera.adjustCamera(this.game.player,this.game.world.width,this.game.world.height)}render(){switch(this.display.renderer.clear(),this.state){case"loading":this.display.drawLoading(),this.display.render();break;case"game":var i=this.display.library.zones[this.game.world.activeZone].config.tilesets.filter(i=>"images"===i.name)[0];this.display.drawBackgrounds(),this.display.drawMap(this.game.world.backgroundMap,this.game.world.columns,i),this.game.world.middleBackgroundMap&&this.display.drawMap(this.game.world.middleBackgroundMap,this.game.world.columns,i),this.display.drawMap(this.game.world.middleMap,this.game.world.columns,i),this.game.world.middleFrontMap&&this.display.drawMap(this.game.world.middleFrontMap,this.game.world.columns,i),this.display.drawCharacters(this.game.objects[this.game.world.activeZone].characters),this.display.drawCollectables(this.game.objects[this.game.world.activeZone].collectables),this.display.drawMap(this.game.world.frontMap,this.game.world.columns,i),window.SHOW_COLLISIONS&&this.display.drawCollisionDebugMap(this.game.world.collisionDebugMap),this.display.drawHud(this.game.player,this.game.spriteMap),this.display.drawPopup(),this.display.render(),this.display.camera.adjustCamera(this.game.player,this.game.world.width,this.game.world.height)}}update(){switch(this.state){case"game":this.game.player.isJumpActive=this.controller.jump.isActive,this.game.player.isUpActive=this.controller.up.isActive,this.areControlsDisabled||(this.controller.isAnyKeyIsActive&&this.bus.publish(this.bus.HIDE_POPUP),this.game.player.isClimbing?this.adjustClimbingControls():this.adjustMovingControls()),this.game.update()}}loadZone(i){this.engine.stop(),this.game.player.destination.x=i.x,this.game.player.destination.y=i.y,this.game.player.destination.name=i.name,this.game.loadZone(i.name),this.display.camera.adjustCamera(this.game.player,this.game.world.width,this.game.world.height),this.updateZoneAssets(),this.engine.start()}updateZoneAssets(){this.display.backgrounds=this.display.library.zones[this.game.world.activeZone].backgrounds,this.display.mapTileset=this.display.library.zones[this.game.world.activeZone].tileset,this.display.mapTileset.tileSize=this.display.library.zones[this.game.world.activeZone].config.tilesets[0].tilewidth,this.display.mapTileset.columns=this.display.library.zones[this.game.world.activeZone].config.tilesets[0].columns,this.display.images=this.display.library.zones[this.game.world.activeZone].images.spriteSheet,this.display.imagesMap=this.display.library.zones[this.game.world.activeZone].images.spriteMap,this.display.adjustBufferCanvasSize(this.game.world.width,this.game.world.height)}}})}]);
//# sourceMappingURL=main.js.map